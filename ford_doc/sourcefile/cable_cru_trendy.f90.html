<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for CABLE">
    <meta name="author" content="CABLE community" >
    <link rel="icon" href="../favicon.png">

    <title>cable_cru_TRENDY.F90 &ndash; CABLE</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">CABLE </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
            <li><a href="../lists/programs.html">Programs</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>cable_cru_TRENDY.F90
    <small>Source File</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.6% of total for source files.">783 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/cable_cru_TRENDY.F90"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li class="active">cable_cru_TRENDY.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      <a class="list-group-item" href="../module/cable_cru.html">CABLE_CRU</a>
    </div>
  </div>
</div>
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/cable_cru_trendy.f90.html#src">cable_cru_TRENDY.F90</a>
  </div>
</div>

</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: sourcefile~~cable_cru_trendy.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilecable_cru_trendyf90EfferentGraph" width="641pt" height="125pt"
 viewBox="0.00 0.00 641.00 124.83" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph" class="graph" transform="scale(0.948225 0.948225) rotate(0) translate(4 127.64)">
<title>sourcefile~~cable_cru_trendy.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-127.64 672,-127.64 672,4 -4,4"/>
<!-- sourcefile~cable_cru_trendy.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~cable_cru_trendy.f90</title>
<polygon fill="none" stroke="black" points="668,-87 540,-87 540,-63 668,-63 668,-87"/>
<text text-anchor="middle" x="604" y="-72.6" font-family="Helvetica,sans-Serif" font-size="10.50">cable_cru_TRENDY.F90</text>
</g>
<!-- sourcefile~casa_ncdf.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~casa_ncdf.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/casa_ncdf.f90.html" xlink:title="casa_ncdf.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="470.5,-66 387.5,-66 387.5,-42 470.5,-42 470.5,-66"/>
<text text-anchor="middle" x="429" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">casa_ncdf.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~casa_ncdf.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~casa_ncdf.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M539.56,-67.3C520.12,-64.94 498.99,-62.37 480.53,-60.13"/>
<polygon fill="#ff0000" stroke="#ff0000" points="480.92,-56.66 470.57,-58.93 480.08,-63.6 480.92,-56.66"/>
</g>
<!-- sourcefile~cable_define_types.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~cable_define_types.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/cable_define_types.f90.html" xlink:title="cable_define_types.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="318,-108 191,-108 191,-84 318,-84 318,-108"/>
<text text-anchor="middle" x="254.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_define_types.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_define_types.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_define_types.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M581.41,-87.16C561.89,-97.42 531.99,-111.31 504,-117 439.56,-130.1 364.12,-120.27 313.41,-110.1"/>
<polygon fill="#ff0000" stroke="#ff0000" points="314.11,-106.67 303.61,-108.07 312.69,-113.52 314.11,-106.67"/>
</g>
<!-- sourcefile~cable_iovars.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~cable_iovars.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/cable_iovars.f90.html" xlink:title="cable_iovars.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="476,-108 382,-108 382,-84 476,-84 476,-108"/>
<text text-anchor="middle" x="429" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_iovars.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_iovars.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_iovars.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M539.56,-82.7C522.15,-84.81 503.4,-87.09 486.41,-89.15"/>
<polygon fill="#ff0000" stroke="#ff0000" points="485.6,-85.73 476.09,-90.4 486.44,-92.67 485.6,-85.73"/>
</g>
<!-- sourcefile~cable_weathergenerator.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~cable_weathergenerator.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/cable_weathergenerator.f90.html" xlink:title="cable_weathergenerator.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="504,-24 354,-24 354,0 504,0 504,-24"/>
<text text-anchor="middle" x="429" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_weathergenerator.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_weathergenerator.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~cable_cru_trendy.f90&#45;&gt;sourcefile~cable_weathergenerator.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M576.88,-62.86C557.12,-53.94 529.18,-41.88 504,-33 498.13,-30.93 491.95,-28.92 485.76,-27.01"/>
<polygon fill="#ff0000" stroke="#ff0000" points="486.65,-23.63 476.07,-24.11 484.65,-30.33 486.65,-23.63"/>
</g>
<!-- sourcefile~casa_ncdf.f90&#45;&gt;sourcefile~cable_define_types.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~casa_ncdf.f90&#45;&gt;sourcefile~cable_define_types.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M387.12,-63.95C365.59,-69.2 338.78,-75.72 314.99,-81.52"/>
<polygon fill="#ff0000" stroke="#ff0000" points="313.89,-78.18 305,-83.95 315.55,-84.98 313.89,-78.18"/>
</g>
<!-- sourcefile~cable_common.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~cable_common.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/cable_common.f90.html" xlink:title="cable_common.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="308,-66 201,-66 201,-42 308,-42 308,-66"/>
<text text-anchor="middle" x="254.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_common.F90</text>
</a>
</g>
</g>
<!-- sourcefile~casa_ncdf.f90&#45;&gt;sourcefile~cable_common.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~casa_ncdf.f90&#45;&gt;sourcefile~cable_common.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M387.12,-54C366.55,-54 341.17,-54 318.2,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="318.19,-50.5 308.19,-54 318.19,-57.5 318.19,-50.5"/>
</g>
<!-- sourcefile~cable_iovars.f90&#45;&gt;sourcefile~cable_define_types.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~cable_iovars.f90&#45;&gt;sourcefile~cable_define_types.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M381.77,-96C365.35,-96 346.43,-96 328.32,-96"/>
<polygon fill="#00ffff" stroke="#00ffff" points="328.07,-92.5 318.07,-96 328.07,-99.5 328.07,-92.5"/>
</g>
<!-- sourcefile~cable_runtime_opts_mod.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~cable_runtime_opts_mod.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/cable_runtime_opts_mod.f90.html" xlink:title="cable_runtime_opts_mod.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="155,-66 0,-66 0,-42 155,-42 155,-66"/>
<text text-anchor="middle" x="77.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_runtime_opts_mod.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_common.f90&#45;&gt;sourcefile~cable_runtime_opts_mod.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~cable_common.f90&#45;&gt;sourcefile~cable_runtime_opts_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M200.99,-54C189.75,-54 177.58,-54 165.42,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="165.23,-50.5 155.23,-54 165.23,-57.5 165.23,-50.5"/>
</g>
</g>
</svg>
</div><script>var pansourcefilecable_cru_trendyf90EfferentGraph = svgPanZoom('#sourcefilecable_cru_trendyf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: sourcefile~~cable_cru_trendy.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilecable_cru_trendyf90AfferentGraph" width="420pt" height="74pt"
 viewBox="0.00 0.00 420.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~cable_cru_trendy.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-70 416,-70 416,4 -4,4"/>
<!-- sourcefile~cable_cru_trendy.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~cable_cru_trendy.f90</title>
<polygon fill="none" stroke="black" points="128,-45 0,-45 0,-21 128,-21 128,-45"/>
<text text-anchor="middle" x="64" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50">cable_cru_TRENDY.F90</text>
</g>
<!-- sourcefile~cable_mpimaster.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~cable_mpimaster.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/cable_mpimaster.f90.html" xlink:title="cable_mpimaster.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="279,-66 164,-66 164,-42 279,-42 279,-66"/>
<text text-anchor="middle" x="221.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_mpimaster.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_mpimaster.f90&#45;&gt;sourcefile~cable_cru_trendy.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~cable_mpimaster.f90&#45;&gt;sourcefile~cable_cru_trendy.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M163.92,-46.36C155.56,-45.23 146.84,-44.05 138.2,-42.89"/>
<polygon fill="#ff0000" stroke="#ff0000" points="138.49,-39.39 128.11,-41.52 137.55,-46.33 138.49,-39.39"/>
</g>
<!-- sourcefile~cable_driver.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~cable_driver.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/cable_driver.f90.html" xlink:title="cable_driver.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="267.5,-24 175.5,-24 175.5,0 267.5,0 267.5,-24"/>
<text text-anchor="middle" x="221.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_driver.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_driver.f90&#45;&gt;sourcefile~cable_cru_trendy.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~cable_driver.f90&#45;&gt;sourcefile~cable_cru_trendy.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M175.1,-18.13C163.5,-19.7 150.73,-21.42 138.13,-23.12"/>
<polygon fill="#ff0000" stroke="#ff0000" points="137.52,-19.67 128.08,-24.48 138.45,-26.61 137.52,-19.67"/>
</g>
<!-- sourcefile~cable_mpidrv.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~cable_mpidrv.f90</title>
<g id="a_sourcefile~~cable_cru_trendy.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/cable_mpidrv.f90.html" xlink:title="cable_mpidrv.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="412,-66 315,-66 315,-42 412,-42 412,-66"/>
<text text-anchor="middle" x="363.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cable_mpidrv.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpimaster.f90 -->
<g id="sourcefile~~cable_cru_trendy.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~cable_mpidrv.f90&#45;&gt;sourcefile~cable_mpimaster.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M314.71,-54C306.51,-54 297.86,-54 289.27,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="289.25,-50.5 279.25,-54 289.25,-57.5 289.25,-50.5"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 6.0.2 (20221011.1828)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
<br>
    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      <a class="list-group-item" href="../module/cable_cru.html">CABLE_CRU</a>
    </div>
  </div>
</div>
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/cable_cru_trendy.f90.html#src">cable_cru_TRENDY.F90</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a id="ln-1" name="ln-1" href="#ln-1"></a><span class="k">MODULE </span><span class="n">CABLE_CRU</span><span class="w"></span>
<a id="ln-2" name="ln-2" href="#ln-2"></a>
<a id="ln-3" name="ln-3" href="#ln-3"></a><span class="w">  </span><span class="k">USE </span><span class="n">netcdf</span><span class="w">                         </span><span class="c">! Access to netcdf routines</span>
<a id="ln-4" name="ln-4" href="#ln-4"></a><span class="w">       </span>
<a id="ln-5" name="ln-5" href="#ln-5"></a><span class="w">  </span><span class="k">USE </span><span class="n">casa_ncdf_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">HANDLE_ERR</span><span class="p">,</span><span class="w"> </span><span class="n">GET_UNIT</span><span class="w">                       </span><span class="c">! Finds an unused unit number for file opensYMDHMS2DOYSOD, DOYSOD2YMDHMS</span>
<a id="ln-6" name="ln-6" href="#ln-6"></a>
<a id="ln-7" name="ln-7" href="#ln-7"></a><span class="w">  </span><span class="k">USE </span><span class="n">cable_IO_vars_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! Selected cable_iovars.F90 variables:</span>
<a id="ln-8" name="ln-8" href="#ln-8"></a><span class="w">       </span><span class="n">logn</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span><span class="w">             </span><span class="c">! Log file unit number</span>
<a id="ln-9" name="ln-9" href="#ln-9"></a><span class="w">       </span><span class="n">land_x</span><span class="p">,</span><span class="w"> </span><span class="n">land_y</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w">             </span><span class="c">! Col (x) &amp; row (y) indices of each land point in land mask (dimension mland)</span>
<a id="ln-10" name="ln-10" href="#ln-10"></a><span class="w">       </span><span class="n">exists</span><span class="w">                         </span><span class="c">! Only for exists%Snowf, which we will set to .FALSE. because there is no snow</span>
<a id="ln-11" name="ln-11" href="#ln-11"></a><span class="w">  </span><span class="c">! in CRU-NCEP. Setting this ensures snow will be determined in CABLE from temperature.</span>
<a id="ln-12" name="ln-12" href="#ln-12"></a>
<a id="ln-13" name="ln-13" href="#ln-13"></a><span class="w">  </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<a id="ln-14" name="ln-14" href="#ln-14"></a>
<a id="ln-15" name="ln-15" href="#ln-15"></a><span class="w">  </span><span class="c">! Define a type for CRU-NCEP information, and the subtype METVALS</span>
<a id="ln-16" name="ln-16" href="#ln-16"></a>
<a id="ln-17" name="ln-17" href="#ln-17"></a><span class="w">  </span><span class="k">TYPE </span><span class="n">CRU_MET_TYPE</span><span class="w"></span>
<a id="ln-18" name="ln-18" href="#ln-18"></a><span class="w">     </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(:),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">METVALS</span><span class="w">  </span><span class="c">! Define a spatial vector of meteorology for one timestep</span>
<a id="ln-19" name="ln-19" href="#ln-19"></a><span class="w">  </span><span class="k">END TYPE </span><span class="n">CRU_MET_TYPE</span><span class="w"></span>
<a id="ln-20" name="ln-20" href="#ln-20"></a>
<a id="ln-21" name="ln-21" href="#ln-21"></a><span class="w">  </span><span class="k">TYPE </span><span class="n">CRU_TYPE</span><span class="w"></span>
<a id="ln-22" name="ln-22" href="#ln-22"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">mland</span><span class="w">                    </span><span class="c">! Number of land cells</span>
<a id="ln-23" name="ln-23" href="#ln-23"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">NMET</span><span class="w">                     </span><span class="c">! Number of met variable types (rain, lwdn etc) NOT INCLUDING prevTmax and nextTmin</span>
<a id="ln-24" name="ln-24" href="#ln-24"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="w">       </span><span class="c">! Landmask grid size dimensions (x=cols, y=rows)</span>
<a id="ln-25" name="ln-25" href="#ln-25"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">tdimsize</span><span class="w">                 </span><span class="c">! Time dimension of metfiles (met data timesteps per annual file)</span>
<a id="ln-26" name="ln-26" href="#ln-26"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">CYEAR</span><span class="w">                    </span><span class="c">! Current run year, same as CurYear, not necessarily the same as MetYear</span>
<a id="ln-27" name="ln-27" href="#ln-27"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">MetStart</span><span class="w">                 </span><span class="c">! First year of met</span>
<a id="ln-28" name="ln-28" href="#ln-28"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">MetEnd</span><span class="w">                   </span><span class="c">! Last year of met</span>
<a id="ln-29" name="ln-29" href="#ln-29"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">CTSTEP</span><span class="w">                   </span><span class="c">! Current met data timestep (1 to tdimsize, i.e. 365 for CRU-NCEP annual daily files)</span>
<a id="ln-30" name="ln-30" href="#ln-30"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">DTsecs</span><span class="w">                   </span><span class="c">! Model timestep in seconds, converted from namelist value in hours</span>
<a id="ln-31" name="ln-31" href="#ln-31"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">ktau</span><span class="w">                     </span><span class="c">! Current model timestep, reset at the start of a new year of met</span>
<a id="ln-32" name="ln-32" href="#ln-32"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">F_ID</span><span class="p">,</span><span class="w"> </span><span class="n">V_ID</span><span class="w">  </span><span class="c">! NetCDF object id&#39;s for files and variables (NetCDF bookkeeping stuff)</span>
<a id="ln-33" name="ln-33" href="#ln-33"></a><span class="w">     </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(:)</span><span class="w"> </span><span class="p">,</span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">AVG_LWDN</span><span class="w"> </span><span class="c">! Avg of one day&#39;s diurnal cycle of lwdn calculated by Swinbank. AVG_LWDN</span>
<a id="ln-34" name="ln-34" href="#ln-34"></a><span class="w">     </span><span class="c">! is used to rescale the diurnal cycle to match the day&#39;s CRUNCEP lwdn. (dim=mland)</span>
<a id="ln-35" name="ln-35" href="#ln-35"></a><span class="w">     </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(:)</span><span class="w"> </span><span class="p">,</span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CO2VALS</span><span class="w">  </span><span class="c">! Global annual CO2 values (dim is the number of years of data, or 1 if time-invariant)</span>
<a id="ln-36" name="ln-36" href="#ln-36"></a><span class="w">     </span><span class="kt">LOGICAL</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">DirectRead</span><span class="w">     </span><span class="c">! Flag to do with reading small numbers of points efficiently. Set true for small numbers of points</span>
<a id="ln-37" name="ln-37" href="#ln-37"></a><span class="w">     </span><span class="kt">LOGICAL</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">LeapYears</span><span class="w">      </span><span class="c">! Flag for whether leaps years occur, required by CABLE. Always false for CRUNCEP (no Feb 29th)</span>
<a id="ln-38" name="ln-38" href="#ln-38"></a><span class="w">     </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="k">DIMENSION</span><span class="p">(:,:),</span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LandMask</span><span class="w"> </span><span class="c">! Logical landmask, true for land, false for non-land</span>
<a id="ln-39" name="ln-39" href="#ln-39"></a><span class="w">     </span><span class="c">!</span>
<a id="ln-40" name="ln-40" href="#ln-40"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Run</span><span class="w">            </span><span class="c">! Where run type is      : &quot;S0_TRENDY&quot;, &quot;S1_TRENDY&quot;, &quot;S2_TRENDY&quot;</span>
<a id="ln-41" name="ln-41" href="#ln-41"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">CO2</span><span class="w">            </span><span class="c">! CO2 takes value        : &quot;static1860&quot;, &quot;1860_1900&quot;, &quot;1901_2015&quot;</span>
<a id="ln-42" name="ln-42" href="#ln-42"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Ndep</span><span class="w">            </span><span class="c">! Ndep takes value        : &quot;static1860&quot;, &quot;1860_1900&quot;, &quot;1901_2015&quot;</span>
<a id="ln-43" name="ln-43" href="#ln-43"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Forcing</span><span class="w">        </span><span class="c">! Met Forcing takes value: &quot;spinup&quot;,        &quot;spinup&quot;, &quot;1901_2015&quot;</span>
<a id="ln-44" name="ln-44" href="#ln-44"></a><span class="w">     </span><span class="c">!</span>
<a id="ln-45" name="ln-45" href="#ln-45"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">BasePath</span><span class="w">       </span><span class="c">! Full path for the location of data used for CRU runs &quot;/x/y&quot;</span>
<a id="ln-46" name="ln-46" href="#ln-46"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MetPath</span><span class="w">        </span><span class="c">! Full path for the location of the met files &quot;/x/y&quot;</span>
<a id="ln-47" name="ln-47" href="#ln-47"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LandMaskFile</span><span class="w">   </span><span class="c">! Land mask filename, without path</span>
<a id="ln-48" name="ln-48" href="#ln-48"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">VAR_NAME</span><span class="w">  </span><span class="c">! Netcdf variable &#39;Name&#39; for each type of met (dim=# of met vars). Note: Name, not &#39;Title&#39;</span>
<a id="ln-49" name="ln-49" href="#ln-49"></a><span class="w">     </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MetFile</span><span class="w">   </span><span class="c">! Met file names incl metpath, constructed in CRU_GET_FILENAME (dim=# of met vars)</span>
<a id="ln-50" name="ln-50" href="#ln-50"></a><span class="w">     </span><span class="k">TYPE</span><span class="p">(</span><span class="n">CRU_MET_TYPE</span><span class="p">),</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MET</span><span class="w">  </span><span class="c">! Met data vectors (METVALS) for one timestep, dim=# of met vars + 2 for prev Tmax and next Tmin</span>
<a id="ln-51" name="ln-51" href="#ln-51"></a><span class="w">     </span><span class="kt">REAL</span><span class="p">,</span><span class="w">  </span><span class="k">DIMENSION</span><span class="p">(:),</span><span class="w"> </span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NdepVALS</span><span class="w"></span>
<a id="ln-52" name="ln-52" href="#ln-52"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NdepF_ID</span><span class="p">,</span><span class="w"> </span><span class="n">NdepV_ID</span><span class="w"></span>
<a id="ln-53" name="ln-53" href="#ln-53"></a><span class="w">     </span><span class="kt">INTEGER</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">Ndep_CTSTEP</span><span class="w">   </span><span class="c">! counter for Ndep in input file</span>
<a id="ln-54" name="ln-54" href="#ln-54"></a><span class="w">  </span><span class="k">END TYPE </span><span class="n">CRU_TYPE</span><span class="w"></span>
<a id="ln-55" name="ln-55" href="#ln-55"></a>
<a id="ln-56" name="ln-56" href="#ln-56"></a><span class="w">  </span><span class="k">TYPE</span><span class="w"> </span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w">  </span><span class="c">! Define the variable CRU, of type CRU_TYPE</span>
<a id="ln-57" name="ln-57" href="#ln-57"></a>
<a id="ln-58" name="ln-58" href="#ln-58"></a><span class="w">  </span><span class="c">! Define local parameter names representing the position of each met var within variable MET.</span>
<a id="ln-59" name="ln-59" href="#ln-59"></a><span class="w">  </span><span class="c">! prevTmax and nextTmin are special cases of Tmax and Tmin that do not count as extra met variables per se.</span>
<a id="ln-60" name="ln-60" href="#ln-60"></a><span class="w">  </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="k">PARAMETER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-61" name="ln-61" href="#ln-61"></a><span class="w">       </span><span class="n">rain</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-62" name="ln-62" href="#ln-62"></a><span class="w">       </span><span class="n">lwdn</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-63" name="ln-63" href="#ln-63"></a><span class="w">       </span><span class="n">swdn</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-64" name="ln-64" href="#ln-64"></a><span class="w">       </span><span class="n">pres</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-65" name="ln-65" href="#ln-65"></a><span class="w">       </span><span class="n">qair</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-66" name="ln-66" href="#ln-66"></a><span class="w">       </span><span class="n">tmax</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-67" name="ln-67" href="#ln-67"></a><span class="w">       </span><span class="n">tmin</span><span class="w">     </span><span class="o">=</span><span class="w">  </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-68" name="ln-68" href="#ln-68"></a><span class="w">       </span><span class="n">uwind</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-69" name="ln-69" href="#ln-69"></a><span class="w">       </span><span class="n">vwind</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-70" name="ln-70" href="#ln-70"></a><span class="w">                                </span><span class="c">!</span>
<a id="ln-71" name="ln-71" href="#ln-71"></a><span class="w">       </span><span class="n">prevTmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-72" name="ln-72" href="#ln-72"></a><span class="w">       </span><span class="n">nextTmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<a id="ln-73" name="ln-73" href="#ln-73"></a>
<a id="ln-74" name="ln-74" href="#ln-74"></a><span class="w">  </span><span class="c">! Error status of various operations (mostly netcdf-related). Typically 0 means ok, &gt; 0 means unexpected condition.</span>
<a id="ln-75" name="ln-75" href="#ln-75"></a><span class="w">  </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">PRIVATE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ErrStatus</span><span class="w"></span>
<a id="ln-76" name="ln-76" href="#ln-76"></a>
<a id="ln-77" name="ln-77" href="#ln-77"></a><span class="w">  </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="k">PARAMETER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">SecDay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8640</span><span class="mf">0.</span><span class="w"> </span><span class="c">! Number of seconds in a day</span>
<a id="ln-78" name="ln-78" href="#ln-78"></a>
<a id="ln-79" name="ln-79" href="#ln-79"></a><span class="w">  </span><span class="c">! Filename prefix expected in the names of met files. Used by CRU_GET_FILENAME to construct met file names.</span>
<a id="ln-80" name="ln-80" href="#ln-80"></a><span class="w">  </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="k">DIMENSION</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span><span class="w"> </span><span class="k">PARAMETER</span><span class="p">,</span><span class="w"> </span><span class="k">PRIVATE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-81" name="ln-81" href="#ln-81"></a><span class="w">       </span><span class="n">PREF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="s2">&quot;rain  &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;lwdown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;swdown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;press &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;qair  &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tmax  &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tmin  &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uwind &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;vwind &quot;</span><span class="w"> </span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<a id="ln-82" name="ln-82" href="#ln-82"></a>
<a id="ln-83" name="ln-83" href="#ln-83"></a><span class="k">CONTAINS</span><span class="w"></span>
<a id="ln-84" name="ln-84" href="#ln-84"></a>
<a id="ln-85" name="ln-85" href="#ln-85"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-86" name="ln-86" href="#ln-86"></a>
<a id="ln-87" name="ln-87" href="#ln-87"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">CRU_INIT</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-88" name="ln-88" href="#ln-88"></a>
<a id="ln-89" name="ln-89" href="#ln-89"></a><span class="w">    </span><span class="c">! Initialise the contents of the CRU defined type collection, from the CRU namelist file</span>
<a id="ln-90" name="ln-90" href="#ln-90"></a><span class="w">    </span><span class="c">! and by obtaining dimensions from the landmask</span>
<a id="ln-91" name="ln-91" href="#ln-91"></a>
<a id="ln-92" name="ln-92" href="#ln-92"></a><span class="w">    </span><span class="c">!**************************************************************************************************</span>
<a id="ln-93" name="ln-93" href="#ln-93"></a>
<a id="ln-94" name="ln-94" href="#ln-94"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_IO_vars_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-95" name="ln-95" href="#ln-95"></a><span class="w">         </span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (R) Lat and long of landcells only (?)</span>
<a id="ln-96" name="ln-96" href="#ln-96"></a><span class="w">         </span><span class="n">nmetpatches</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (I) Size of patch dimension in met file, if it exists</span>
<a id="ln-97" name="ln-97" href="#ln-97"></a><span class="w">         </span><span class="n">mask</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (I) Land/sea mask (1,0)</span>
<a id="ln-98" name="ln-98" href="#ln-98"></a><span class="w">         </span><span class="n">metGrid</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (C4) Either &#39;land&#39; or &#39;mask&#39; for whether the data are packed or not (?)</span>
<a id="ln-99" name="ln-99" href="#ln-99"></a><span class="w">         </span><span class="n">sdoy</span><span class="p">,</span><span class="w"> </span><span class="n">smoy</span><span class="p">,</span><span class="w"> </span><span class="n">syear</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (I) Start time day of year, month, year</span>
<a id="ln-100" name="ln-100" href="#ln-100"></a><span class="w">         </span><span class="n">shod</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (R) Start time hour of day</span>
<a id="ln-101" name="ln-101" href="#ln-101"></a><span class="w">         </span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"> </span><span class="c">! (I) Size of grid dimensions</span>
<a id="ln-102" name="ln-102" href="#ln-102"></a><span class="w">         </span><span class="n">lat_all</span><span class="p">,</span><span class="w"> </span><span class="n">lon_all</span><span class="w">       </span><span class="c">! (R) Grids with the lat or lon of each cell (i.e. repetition along rows/cols), for CABLE.</span>
<a id="ln-103" name="ln-103" href="#ln-103"></a>
<a id="ln-104" name="ln-104" href="#ln-104"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_def_types_mod</span><span class="p">,</span><span class="w">  </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">mland</span><span class="w">  </span><span class="c">! (I) Number of land cells</span>
<a id="ln-105" name="ln-105" href="#ln-105"></a>
<a id="ln-106" name="ln-106" href="#ln-106"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-107" name="ln-107" href="#ln-107"></a>
<a id="ln-108" name="ln-108" href="#ln-108"></a><span class="k">    TYPE</span><span class="w"> </span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w"></span>
<a id="ln-109" name="ln-109" href="#ln-109"></a>
<a id="ln-110" name="ln-110" href="#ln-110"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">ErrStatus</span><span class="w">  </span><span class="c">! Error status returned by nc routines (zero=ok, non-zero=error)</span>
<a id="ln-111" name="ln-111" href="#ln-111"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">nmlunit</span><span class="w">    </span><span class="c">! Unit number for reading namelist file</span>
<a id="ln-112" name="ln-112" href="#ln-112"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">FID</span><span class="w">        </span><span class="c">! NetCDF id for the landmask file</span>
<a id="ln-113" name="ln-113" href="#ln-113"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">latID</span><span class="p">,</span><span class="w"> </span><span class="n">lonID</span><span class="p">,</span><span class="w"> </span><span class="n">timID</span><span class="w">  </span><span class="c">! NetCDF ids for dimensions in the landmask file</span>
<a id="ln-114" name="ln-114" href="#ln-114"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">landID</span><span class="w">     </span><span class="c">! NetCDF id for the landmask variable in the landmask file</span>
<a id="ln-115" name="ln-115" href="#ln-115"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">tdimsize</span><span class="w">   </span><span class="c">! Time dimension in the met file, not used here apparently (??)</span>
<a id="ln-116" name="ln-116" href="#ln-116"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">landcnt</span><span class="w">    </span><span class="c">! Manually incremented counter for the number of land cells</span>
<a id="ln-117" name="ln-117" href="#ln-117"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">xcol</span><span class="p">,</span><span class="w"> </span><span class="n">yrow</span><span class="w"> </span><span class="c">! Column and row position in the data file grids</span>
<a id="ln-118" name="ln-118" href="#ln-118"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">imetvar</span><span class="w">    </span><span class="c">! loop counter through met variables</span>
<a id="ln-119" name="ln-119" href="#ln-119"></a>
<a id="ln-120" name="ln-120" href="#ln-120"></a><span class="w">    </span><span class="c">! Temporary local names for CRU% variables as they are read from the namelist file.</span>
<a id="ln-121" name="ln-121" href="#ln-121"></a><span class="w">    </span><span class="c">! Note that CRU%CO2 and CRU%Forcing are assigned based on the value of Run, not read as options from the namelist file.</span>
<a id="ln-122" name="ln-122" href="#ln-122"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">DirectRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-123" name="ln-123" href="#ln-123"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">Run</span><span class="w"></span>
<a id="ln-124" name="ln-124" href="#ln-124"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">BasePath</span><span class="w"></span>
<a id="ln-125" name="ln-125" href="#ln-125"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">MetPath</span><span class="w"></span>
<a id="ln-126" name="ln-126" href="#ln-126"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">LandMaskFile</span><span class="w"></span>
<a id="ln-127" name="ln-127" href="#ln-127"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">                 </span><span class="kd">::</span><span class="w"> </span><span class="n">DThrs</span><span class="w">   </span><span class="c">! CABLE timestep (hrs), converted immediately to integer seconds for CRU%DTsecs</span>
<a id="ln-128" name="ln-128" href="#ln-128"></a><span class="w">    </span><span class="kt">REAL</span><span class="p">,</span><span class="k">DIMENSION</span><span class="p">(:)</span><span class="w">     </span><span class="p">,</span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU_lats</span><span class="p">,</span><span class="w"> </span><span class="n">CRU_lons</span><span class="w">  </span><span class="c">! Lat/long values for each grid rows/cols from landmask.</span>
<a id="ln-129" name="ln-129" href="#ln-129"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="k">DIMENSION</span><span class="p">(:,:),</span><span class="k">ALLOCATABLE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">landmask</span><span class="w"></span>
<a id="ln-130" name="ln-130" href="#ln-130"></a>
<a id="ln-131" name="ln-131" href="#ln-131"></a><span class="w">    </span><span class="c">! Flag for errors</span>
<a id="ln-132" name="ln-132" href="#ln-132"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">ERR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-133" name="ln-133" href="#ln-133"></a>
<a id="ln-134" name="ln-134" href="#ln-134"></a><span class="w">    </span><span class="k">NAMELIST</span><span class="w"> </span><span class="o">/</span><span class="n">CRUNML</span><span class="o">/</span><span class="w"> </span><span class="n">BasePath</span><span class="p">,</span><span class="w"> </span><span class="n">MetPath</span><span class="p">,</span><span class="w"> </span><span class="n">LandMaskFile</span><span class="p">,</span><span class="w"> </span><span class="n">Run</span><span class="p">,</span><span class="w"> </span><span class="n">DThrs</span><span class="p">,</span><span class="w"> </span><span class="n">DirectRead</span><span class="w"></span>
<a id="ln-135" name="ln-135" href="#ln-135"></a>
<a id="ln-136" name="ln-136" href="#ln-136"></a><span class="w">    </span><span class="c">! Read CRU namelist settings</span>
<a id="ln-137" name="ln-137" href="#ln-137"></a><span class="w">    </span><span class="k">CALL </span><span class="n">GET_UNIT</span><span class="p">(</span><span class="n">nmlunit</span><span class="p">)</span><span class="w">  </span><span class="c">! CABLE routine finds spare unit number</span>
<a id="ln-138" name="ln-138" href="#ln-138"></a><span class="w">    </span><span class="k">OPEN</span><span class="w"> </span><span class="p">(</span><span class="n">nmlunit</span><span class="p">,</span><span class="k">FILE</span><span class="o">=</span><span class="s2">&quot;cru.nml&quot;</span><span class="p">,</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;OLD&#39;</span><span class="p">,</span><span class="n">ACTION</span><span class="o">=</span><span class="s1">&#39;READ&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-139" name="ln-139" href="#ln-139"></a><span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="p">(</span><span class="n">nmlunit</span><span class="p">,</span><span class="n">NML</span><span class="o">=</span><span class="n">CRUNML</span><span class="p">)</span><span class="w"></span>
<a id="ln-140" name="ln-140" href="#ln-140"></a><span class="w">    </span><span class="k">CLOSE</span><span class="p">(</span><span class="n">nmlunit</span><span class="p">)</span><span class="w"></span>
<a id="ln-141" name="ln-141" href="#ln-141"></a>
<a id="ln-142" name="ln-142" href="#ln-142"></a><span class="w">    </span><span class="c">! Assign namelist settings to corresponding CRU defined-type elements</span>
<a id="ln-143" name="ln-143" href="#ln-143"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">BasePath</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">BasePath</span><span class="w"></span>
<a id="ln-144" name="ln-144" href="#ln-144"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">MetPath</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">MetPath</span><span class="w"></span>
<a id="ln-145" name="ln-145" href="#ln-145"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">LandMaskFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LandMaskFile</span><span class="w"></span>
<a id="ln-146" name="ln-146" href="#ln-146"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">Run</span><span class="w"></span>
<a id="ln-147" name="ln-147" href="#ln-147"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">DTsecs</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">DThrs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">360</span><span class="mf">0.</span><span class="p">)</span><span class="w">  </span><span class="c">! in seconds</span>
<a id="ln-148" name="ln-148" href="#ln-148"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">DirectRead</span><span class="w"></span>
<a id="ln-149" name="ln-149" href="#ln-149"></a>
<a id="ln-150" name="ln-150" href="#ln-150"></a><span class="w">    </span><span class="c">! Assign Forcing and CO2 labels based only on the value of CRU%Run</span>
<a id="ln-151" name="ln-151" href="#ln-151"></a><span class="w">    </span><span class="k">SELECT CASE</span><span class="w"> </span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">))</span><span class="w"></span>
<a id="ln-152" name="ln-152" href="#ln-152"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-153" name="ln-153" href="#ln-153"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-154" name="ln-154" href="#ln-154"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-155" name="ln-155" href="#ln-155"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-156" name="ln-156" href="#ln-156"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-157" name="ln-157" href="#ln-157"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-158" name="ln-158" href="#ln-158"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_CO2&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-159" name="ln-159" href="#ln-159"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-160" name="ln-160" href="#ln-160"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-161" name="ln-161" href="#ln-161"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-162" name="ln-162" href="#ln-162"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S0_CO2&#39;: Therefore Forcing = &#39;S0_CO2&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-163" name="ln-163" href="#ln-163"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S0_CO2&#39;: Therefore Forcing = &#39;S0_CO2&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-164" name="ln-164" href="#ln-164"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_Ndep&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-165" name="ln-165" href="#ln-165"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-166" name="ln-166" href="#ln-166"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-167" name="ln-167" href="#ln-167"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-168" name="ln-168" href="#ln-168"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S0_Ndep&#39;: Therefore Forcing = &#39;S0_Ndep&#39;, Ndep = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-169" name="ln-169" href="#ln-169"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S0_Ndep&#39;: Therefore Forcing = &#39;S0_Ndep&#39;, Ndep = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-170" name="ln-170" href="#ln-170"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_Precip&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-171" name="ln-171" href="#ln-171"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-172" name="ln-172" href="#ln-172"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-173" name="ln-173" href="#ln-173"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-174" name="ln-174" href="#ln-174"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-175" name="ln-175" href="#ln-175"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-176" name="ln-176" href="#ln-176"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_Temp&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-177" name="ln-177" href="#ln-177"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-178" name="ln-178" href="#ln-178"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-179" name="ln-179" href="#ln-179"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-180" name="ln-180" href="#ln-180"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-181" name="ln-181" href="#ln-181"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-182" name="ln-182" href="#ln-182"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_Temp_Precip&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-183" name="ln-183" href="#ln-183"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-184" name="ln-184" href="#ln-184"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-185" name="ln-185" href="#ln-185"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-186" name="ln-186" href="#ln-186"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-187" name="ln-187" href="#ln-187"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;static1860&#39;&quot;</span><span class="w"></span>
<a id="ln-188" name="ln-188" href="#ln-188"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_CO2_Temp&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-189" name="ln-189" href="#ln-189"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-190" name="ln-190" href="#ln-190"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-191" name="ln-191" href="#ln-191"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-192" name="ln-192" href="#ln-192"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-193" name="ln-193" href="#ln-193"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-194" name="ln-194" href="#ln-194"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_CO2_Precip&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-195" name="ln-195" href="#ln-195"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-196" name="ln-196" href="#ln-196"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-197" name="ln-197" href="#ln-197"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-198" name="ln-198" href="#ln-198"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-199" name="ln-199" href="#ln-199"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-200" name="ln-200" href="#ln-200"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S0_TRENDY_CO2_Temp_Precip&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-201" name="ln-201" href="#ln-201"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-202" name="ln-202" href="#ln-202"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-203" name="ln-203" href="#ln-203"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="w"></span>
<a id="ln-204" name="ln-204" href="#ln-204"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-205" name="ln-205" href="#ln-205"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;spinup&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-206" name="ln-206" href="#ln-206"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S1_TRENDY&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-207" name="ln-207" href="#ln-207"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;spinup&quot;</span><span class="w"></span>
<a id="ln-208" name="ln-208" href="#ln-208"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1860_1900&quot;</span><span class="w"></span>
<a id="ln-209" name="ln-209" href="#ln-209"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1860_1900&quot;</span><span class="w"></span>
<a id="ln-210" name="ln-210" href="#ln-210"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S1_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_1900&#39;&quot;</span><span class="w"></span>
<a id="ln-211" name="ln-211" href="#ln-211"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S1_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1860_1900&#39;&quot;</span><span class="w"></span>
<a id="ln-212" name="ln-212" href="#ln-212"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S2_TRENDY&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-213" name="ln-213" href="#ln-213"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-214" name="ln-214" href="#ln-214"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-215" name="ln-215" href="#ln-215"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-216" name="ln-216" href="#ln-216"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-217" name="ln-217" href="#ln-217"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-218" name="ln-218" href="#ln-218"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S2_TRENDY_precip&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-219" name="ln-219" href="#ln-219"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-220" name="ln-220" href="#ln-220"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-221" name="ln-221" href="#ln-221"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-222" name="ln-222" href="#ln-222"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-223" name="ln-223" href="#ln-223"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-224" name="ln-224" href="#ln-224"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;S2_TRENDY_precip0&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-225" name="ln-225" href="#ln-225"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-226" name="ln-226" href="#ln-226"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-227" name="ln-227" href="#ln-227"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1901_2015&quot;</span><span class="w"></span>
<a id="ln-228" name="ln-228" href="#ln-228"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-229" name="ln-229" href="#ln-229"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Run = &#39;S2_TRENDY&#39;: Therefore Forcing = &#39;spinup&#39;, CO2 = &#39;1901_2015&#39;&quot;</span><span class="w"></span>
<a id="ln-230" name="ln-230" href="#ln-230"></a><span class="w">    </span><span class="k">CASE  </span><span class="n">default</span><span class="w"></span>
<a id="ln-231" name="ln-231" href="#ln-231"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Wrong CRU%Run: &quot;</span><span class="p">,</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="w"></span>
<a id="ln-232" name="ln-232" href="#ln-232"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Use: S0_TRENDY, S1_TRENDY, or S2_TRENDY!&quot;</span><span class="w"></span>
<a id="ln-233" name="ln-233" href="#ln-233"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Wrong CRU%Run: &quot;</span><span class="p">,</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="w"></span>
<a id="ln-234" name="ln-234" href="#ln-234"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Use: S0_TRENDY, S1_TRENDY, or S2_TRENDY!&quot;</span><span class="w"></span>
<a id="ln-235" name="ln-235" href="#ln-235"></a><span class="w">       </span><span class="n">ERR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<a id="ln-236" name="ln-236" href="#ln-236"></a><span class="w">    </span><span class="k">END SELECT</span><span class="w"></span>
<a id="ln-237" name="ln-237" href="#ln-237"></a>
<a id="ln-238" name="ln-238" href="#ln-238"></a><span class="w">    </span><span class="c">! Print settings</span>
<a id="ln-239" name="ln-239" href="#ln-239"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;========================================= CRU ============&quot;</span><span class="w"></span>
<a id="ln-240" name="ln-240" href="#ln-240"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;CRU settings chosen:&quot;</span><span class="w"></span>
<a id="ln-241" name="ln-241" href="#ln-241"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; BasePath: &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">BasePath</span><span class="p">)</span><span class="w"></span>
<a id="ln-242" name="ln-242" href="#ln-242"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; LandMask: &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">LandMaskFile</span><span class="p">)</span><span class="w"></span>
<a id="ln-243" name="ln-243" href="#ln-243"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Run                : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"></span>
<a id="ln-244" name="ln-244" href="#ln-244"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Forcing (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="p">)</span><span class="w"></span>
<a id="ln-245" name="ln-245" href="#ln-245"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; CO2     (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="p">)</span><span class="w"></span>
<a id="ln-246" name="ln-246" href="#ln-246"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Ndep     (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="p">)</span><span class="w"></span>
<a id="ln-247" name="ln-247" href="#ln-247"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; DT(secs): &quot;</span><span class="p">,</span><span class="n">CRU</span><span class="p">%</span><span class="n">DTsecs</span><span class="w"></span>
<a id="ln-248" name="ln-248" href="#ln-248"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;========================================= CRU ============&quot;</span><span class="w"></span>
<a id="ln-249" name="ln-249" href="#ln-249"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;CRU settings chosen:&quot;</span><span class="w"></span>
<a id="ln-250" name="ln-250" href="#ln-250"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; BasePath: &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">BasePath</span><span class="p">)</span><span class="w"></span>
<a id="ln-251" name="ln-251" href="#ln-251"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; LandMask: &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">LandMaskFile</span><span class="p">)</span><span class="w"></span>
<a id="ln-252" name="ln-252" href="#ln-252"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Run                : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"></span>
<a id="ln-253" name="ln-253" href="#ln-253"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Forcing (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Forcing</span><span class="p">)</span><span class="w"></span>
<a id="ln-254" name="ln-254" href="#ln-254"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; CO2     (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="p">)</span><span class="w"></span>
<a id="ln-255" name="ln-255" href="#ln-255"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; Ndep     (assigned) : &quot;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="p">)</span><span class="w"></span>
<a id="ln-256" name="ln-256" href="#ln-256"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot; DT(secs): &quot;</span><span class="p">,</span><span class="n">CRU</span><span class="p">%</span><span class="n">DTsecs</span><span class="w"></span>
<a id="ln-257" name="ln-257" href="#ln-257"></a>
<a id="ln-258" name="ln-258" href="#ln-258"></a><span class="w">    </span><span class="c">! Error trap for bad namelist.</span>
<a id="ln-259" name="ln-259" href="#ln-259"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ERR</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-260" name="ln-260" href="#ln-260"></a><span class="k">       WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;Invalid settings in CRU_INIT&quot;</span><span class="w"></span>
<a id="ln-261" name="ln-261" href="#ln-261"></a><span class="w">       </span><span class="k">STOP</span><span class="w"> </span><span class="s2">&quot;Invalid settings in CRU_INIT&quot;</span><span class="w"></span>
<a id="ln-262" name="ln-262" href="#ln-262"></a><span class="w">    </span><span class="k">ENDIF</span><span class="w"></span>
<a id="ln-263" name="ln-263" href="#ln-263"></a>
<a id="ln-264" name="ln-264" href="#ln-264"></a><span class="w">    </span><span class="c">! If this is a S0_TRENDY run look for met data in the spinup directory instead.</span>
<a id="ln-265" name="ln-265" href="#ln-265"></a><span class="w">    </span><span class="c">!IF (TRIM(CRU%Run) .EQ. &quot;S0_TRENDY&quot;) THEN</span>
<a id="ln-266" name="ln-266" href="#ln-266"></a><span class="w">    </span><span class="c">!   CRU%MetPath = TRIM(CRU%MetPath)//&quot;/spinup_data&quot;</span>
<a id="ln-267" name="ln-267" href="#ln-267"></a><span class="w">    </span><span class="c">!ENDIF</span>
<a id="ln-268" name="ln-268" href="#ln-268"></a>
<a id="ln-269" name="ln-269" href="#ln-269"></a><span class="w">    </span><span class="c">! Set variable names to their NetCDF &#39;Names&#39; (i.e. not their &#39;Titles&#39;)</span>
<a id="ln-270" name="ln-270" href="#ln-270"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">NMET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<a id="ln-271" name="ln-271" href="#ln-271"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">rain</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Total_Precipitation&quot;</span><span class="w"></span>
<a id="ln-272" name="ln-272" href="#ln-272"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">lwdn</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Incoming_Long_Wave_Radiation&quot;</span><span class="w"></span>
<a id="ln-273" name="ln-273" href="#ln-273"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">swdn</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Incoming_Short_Wave_Radiation&quot;</span><span class="w"></span>
<a id="ln-274" name="ln-274" href="#ln-274"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">pres</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Pression&quot;</span><span class="w"></span>
<a id="ln-275" name="ln-275" href="#ln-275"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">qair</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Air_Specific_Humidity&quot;</span><span class="w"></span>
<a id="ln-276" name="ln-276" href="#ln-276"></a><span class="w">    </span><span class="c">! CRU%VAR_NAME(tmax)  = &quot;maximum_6h_air_temperature&quot;</span>
<a id="ln-277" name="ln-277" href="#ln-277"></a><span class="w">    </span><span class="c">! CRU%VAR_NAME(tmin)  = &quot;minimum_6h_air_temperature&quot;</span>
<a id="ln-278" name="ln-278" href="#ln-278"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;maximum_air_temperature&quot;</span><span class="w"></span>
<a id="ln-279" name="ln-279" href="#ln-279"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">tmin</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;minimum_air_temperature&quot;</span><span class="w"></span>
<a id="ln-280" name="ln-280" href="#ln-280"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">uwind</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;U_wind_component&quot;</span><span class="w"></span>
<a id="ln-281" name="ln-281" href="#ln-281"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">vwind</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;V_wind_component&quot;</span><span class="w"></span>
<a id="ln-282" name="ln-282" href="#ln-282"></a>
<a id="ln-283" name="ln-283" href="#ln-283"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;========================================= CRU ============&quot;</span><span class="w"></span>
<a id="ln-284" name="ln-284" href="#ln-284"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;========================================= CRU ============&quot;</span><span class="w"></span>
<a id="ln-285" name="ln-285" href="#ln-285"></a>
<a id="ln-286" name="ln-286" href="#ln-286"></a><span class="w">    </span><span class="c">! Now read landmask file</span>
<a id="ln-287" name="ln-287" href="#ln-287"></a><span class="w">    </span><span class="c">! Landmask file into init! Get LAt, LON etc. from there</span>
<a id="ln-288" name="ln-288" href="#ln-288"></a><span class="w">    </span><span class="c">! LMFILE = TRIM(CRU%LandMaskFile)</span>
<a id="ln-289" name="ln-289" href="#ln-289"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening CRU landmask file: &#39;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">)</span><span class="w"></span>
<a id="ln-290" name="ln-290" href="#ln-290"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening CRU landmask file: &#39;</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">)</span><span class="w"></span>
<a id="ln-291" name="ln-291" href="#ln-291"></a>
<a id="ln-292" name="ln-292" href="#ln-292"></a><span class="w">    </span><span class="c">! Open the land mask file</span>
<a id="ln-293" name="ln-293" href="#ln-293"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">FID</span><span class="p">)</span><span class="w"></span>
<a id="ln-294" name="ln-294" href="#ln-294"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU Land-mask file&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-295" name="ln-295" href="#ln-295"></a>
<a id="ln-296" name="ln-296" href="#ln-296"></a><span class="w">    </span><span class="c">! Latitude: Get the dimension ID, find the size of the dimension, assign it to CRU.</span>
<a id="ln-297" name="ln-297" href="#ln-297"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_DIMID</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">latID</span><span class="p">)</span><span class="w"></span>
<a id="ln-298" name="ln-298" href="#ln-298"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_DIMENSION</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="n">latID</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">ydimsize</span><span class="p">)</span><span class="w"></span>
<a id="ln-299" name="ln-299" href="#ln-299"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;lat&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-300" name="ln-300" href="#ln-300"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">ydimsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ydimsize</span><span class="w"></span>
<a id="ln-301" name="ln-301" href="#ln-301"></a>
<a id="ln-302" name="ln-302" href="#ln-302"></a><span class="w">    </span><span class="c">! Collect the latitudes into CRU_lats</span>
<a id="ln-303" name="ln-303" href="#ln-303"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU_lats</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ydimsize</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-304" name="ln-304" href="#ln-304"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">latID</span><span class="p">)</span><span class="w"></span>
<a id="ln-305" name="ln-305" href="#ln-305"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;latitudes&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-306" name="ln-306" href="#ln-306"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="n">latID</span><span class="p">,</span><span class="n">CRU_lats</span><span class="p">)</span><span class="w"></span>
<a id="ln-307" name="ln-307" href="#ln-307"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading &#39;latitudes&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-308" name="ln-308" href="#ln-308"></a>
<a id="ln-309" name="ln-309" href="#ln-309"></a><span class="w">    </span><span class="c">! Longitude: Get the dimension ID, find the size of the dimension, assign it to CRU.</span>
<a id="ln-310" name="ln-310" href="#ln-310"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_DIMID</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="n">lonID</span><span class="p">)</span><span class="w"></span>
<a id="ln-311" name="ln-311" href="#ln-311"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_DIMENSION</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="n">lonID</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">xdimsize</span><span class="p">)</span><span class="w"></span>
<a id="ln-312" name="ln-312" href="#ln-312"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;lon&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-313" name="ln-313" href="#ln-313"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">xdimsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xdimsize</span><span class="w"></span>
<a id="ln-314" name="ln-314" href="#ln-314"></a>
<a id="ln-315" name="ln-315" href="#ln-315"></a><span class="w">    </span><span class="c">! Collect the longitudes into CRU_lons</span>
<a id="ln-316" name="ln-316" href="#ln-316"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU_lons</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xdimsize</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-317" name="ln-317" href="#ln-317"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="n">lonID</span><span class="p">)</span><span class="w"></span>
<a id="ln-318" name="ln-318" href="#ln-318"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;longitudes&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-319" name="ln-319" href="#ln-319"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="n">lonID</span><span class="p">,</span><span class="n">CRU_lons</span><span class="p">)</span><span class="w"></span>
<a id="ln-320" name="ln-320" href="#ln-320"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading &#39;longitudes&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-321" name="ln-321" href="#ln-321"></a>
<a id="ln-322" name="ln-322" href="#ln-322"></a><span class="w">    </span><span class="c">! Allocate the landmask arrays for...</span>
<a id="ln-323" name="ln-323" href="#ln-323"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">landmask</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c">! Passing out to other CRU routines (logical)</span>
<a id="ln-324" name="ln-324" href="#ln-324"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">landmask</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">      </span><span class="c">! Local use in this routine (integer)</span>
<a id="ln-325" name="ln-325" href="#ln-325"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mask</span><span class="p">(</span><span class="w"> </span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="c">! Use by CABLE</span>
<a id="ln-326" name="ln-326" href="#ln-326"></a>
<a id="ln-327" name="ln-327" href="#ln-327"></a><span class="w">    </span><span class="c">! Check that the land mask variable is called &quot;land&quot; in the land mask file,</span>
<a id="ln-328" name="ln-328" href="#ln-328"></a><span class="w">    </span><span class="c">! and read it into local variable landmask</span>
<a id="ln-329" name="ln-329" href="#ln-329"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="s1">&#39;land&#39;</span><span class="p">,</span><span class="n">landID</span><span class="p">)</span><span class="w"></span>
<a id="ln-330" name="ln-330" href="#ln-330"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;land&#39; &quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-331" name="ln-331" href="#ln-331"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">FID</span><span class="p">,</span><span class="n">landID</span><span class="p">,</span><span class="n">landmask</span><span class="p">)</span><span class="w"></span>
<a id="ln-332" name="ln-332" href="#ln-332"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading &#39;land&#39; &quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-333" name="ln-333" href="#ln-333"></a>
<a id="ln-334" name="ln-334" href="#ln-334"></a><span class="w">    </span><span class="c">! Convert the integer landmask into the logical CRU%landmask</span>
<a id="ln-335" name="ln-335" href="#ln-335"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landmask</span><span class="w"> </span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-336" name="ln-336" href="#ln-336"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">landmask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<a id="ln-337" name="ln-337" href="#ln-337"></a><span class="w">       </span><span class="n">mask</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-338" name="ln-338" href="#ln-338"></a><span class="w">    </span><span class="n">ELSEWHERE</span><span class="w"></span>
<a id="ln-339" name="ln-339" href="#ln-339"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">landmask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-340" name="ln-340" href="#ln-340"></a><span class="w">       </span><span class="n">mask</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-341" name="ln-341" href="#ln-341"></a><span class="w">    </span><span class="k">END WHERE</span><span class="w"></span>
<a id="ln-342" name="ln-342" href="#ln-342"></a>
<a id="ln-343" name="ln-343" href="#ln-343"></a><span class="w">    </span><span class="c">! Count the number of land cells -&gt; mland</span>
<a id="ln-344" name="ln-344" href="#ln-344"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">COUNT</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">landmask</span><span class="p">)</span><span class="w"></span>
<a id="ln-345" name="ln-345" href="#ln-345"></a>
<a id="ln-346" name="ln-346" href="#ln-346"></a><span class="w">    </span><span class="c">! Allocate CABLE land-only vectors for lat/long and row/col values/indices.</span>
<a id="ln-347" name="ln-347" href="#ln-347"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">latitude</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">),</span><span class="w"> </span><span class="n">longitude</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-348" name="ln-348" href="#ln-348"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">land_y</span><span class="w">  </span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">),</span><span class="w"> </span><span class="n">land_x</span><span class="w">   </span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-349" name="ln-349" href="#ln-349"></a>
<a id="ln-350" name="ln-350" href="#ln-350"></a><span class="w">    </span><span class="c">! Allocate vectors for each of the different met quantities, including extra</span>
<a id="ln-351" name="ln-351" href="#ln-351"></a><span class="w">    </span><span class="c">! prev/next temperatures for the Cesarracio temperature calculations in the</span>
<a id="ln-352" name="ln-352" href="#ln-352"></a><span class="w">    </span><span class="c">! weather generator.</span>
<a id="ln-353" name="ln-353" href="#ln-353"></a><span class="w">    </span><span class="k">DO </span><span class="n">imetvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NMET</span><span class="w"></span>
<a id="ln-354" name="ln-354" href="#ln-354"></a><span class="w">       </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">imetvar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-355" name="ln-355" href="#ln-355"></a><span class="w">    </span><span class="k">END DO</span>
<a id="ln-356" name="ln-356" href="#ln-356"></a><span class="k">    ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">prevTmax</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-357" name="ln-357" href="#ln-357"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">nextTmin</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-358" name="ln-358" href="#ln-358"></a><span class="w">    </span><span class="c">! allocate array for Nitrogen deposition input data</span>
<a id="ln-359" name="ln-359" href="#ln-359"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepVALS</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-360" name="ln-360" href="#ln-360"></a>
<a id="ln-361" name="ln-361" href="#ln-361"></a><span class="w">    </span><span class="c">! Copy the col/row and lat/long positions of each land cell into the corresponding</span>
<a id="ln-362" name="ln-362" href="#ln-362"></a><span class="w">    </span><span class="c">! land only CABLE vectors. Q: We know mland at this point. Why not use landcnt to confirm</span>
<a id="ln-363" name="ln-363" href="#ln-363"></a><span class="w">    </span><span class="c">! the correct value of mland?</span>
<a id="ln-364" name="ln-364" href="#ln-364"></a><span class="w">    </span><span class="n">landcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-365" name="ln-365" href="#ln-365"></a><span class="w">    </span><span class="k">DO </span><span class="n">yrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="w"></span>
<a id="ln-366" name="ln-366" href="#ln-366"></a><span class="w">       </span><span class="k">DO </span><span class="n">xcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">xdimsize</span><span class="w"></span>
<a id="ln-367" name="ln-367" href="#ln-367"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">landmask</span><span class="p">(</span><span class="n">xcol</span><span class="p">,</span><span class="n">yrow</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CYCLE</span><span class="w">   </span><span class="c">! Go to next iteration if not a land cell</span>
<a id="ln-368" name="ln-368" href="#ln-368"></a>
<a id="ln-369" name="ln-369" href="#ln-369"></a><span class="w">          </span><span class="c">!          WRITE(6,FMT=&#39;(A15,I5,2(1X,F8.2),2(1x,I3))&#39;)&quot;i, lo,la, xcol,yrow&quot;,landcnt,CRU_lons(xcol),CRU_lats(yrow),xcol, yrow</span>
<a id="ln-370" name="ln-370" href="#ln-370"></a>
<a id="ln-371" name="ln-371" href="#ln-371"></a><span class="w">          </span><span class="c">! C</span>
<a id="ln-372" name="ln-372" href="#ln-372"></a><span class="w">          </span><span class="n">land_x</span><span class="p">(</span><span class="n">landcnt</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">xcol</span><span class="w"></span>
<a id="ln-373" name="ln-373" href="#ln-373"></a><span class="w">          </span><span class="n">land_y</span><span class="p">(</span><span class="n">landcnt</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">yrow</span><span class="w"></span>
<a id="ln-374" name="ln-374" href="#ln-374"></a><span class="w">          </span><span class="n">longitude</span><span class="p">(</span><span class="n">landcnt</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU_lons</span><span class="p">(</span><span class="n">xcol</span><span class="p">)</span><span class="w"></span>
<a id="ln-375" name="ln-375" href="#ln-375"></a><span class="w">          </span><span class="n">latitude</span><span class="p">(</span><span class="n">landcnt</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU_lats</span><span class="p">(</span><span class="n">yrow</span><span class="p">)</span><span class="w"></span>
<a id="ln-376" name="ln-376" href="#ln-376"></a><span class="w">          </span><span class="n">landcnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">landcnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-377" name="ln-377" href="#ln-377"></a><span class="w">       </span><span class="k">END DO</span>
<a id="ln-378" name="ln-378" href="#ln-378"></a><span class="k">    END DO</span><span class="w"></span>
<a id="ln-379" name="ln-379" href="#ln-379"></a>
<a id="ln-380" name="ln-380" href="#ln-380"></a><span class="w">    </span><span class="c">! Set global CABLE variables</span>
<a id="ln-381" name="ln-381" href="#ln-381"></a><span class="w">    </span><span class="n">metGrid</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mask&quot;</span><span class="w"></span>
<a id="ln-382" name="ln-382" href="#ln-382"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">mask</span><span class="p">(</span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-383" name="ln-383" href="#ln-383"></a><span class="w">    </span><span class="n">mask</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">landmask</span><span class="w"></span>
<a id="ln-384" name="ln-384" href="#ln-384"></a><span class="w">    </span><span class="n">mland</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-385" name="ln-385" href="#ln-385"></a><span class="w">    </span><span class="n">nmetpatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-386" name="ln-386" href="#ln-386"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">lat_all</span><span class="p">(</span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">),</span><span class="w"> </span><span class="n">lon_all</span><span class="p">(</span><span class="n">xdimsize</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-387" name="ln-387" href="#ln-387"></a><span class="w">    </span><span class="k">DO </span><span class="n">xcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">xdimsize</span><span class="w"></span>
<a id="ln-388" name="ln-388" href="#ln-388"></a><span class="w">       </span><span class="n">lat_all</span><span class="p">(</span><span class="n">xcol</span><span class="p">,:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU_lats</span><span class="w"></span>
<a id="ln-389" name="ln-389" href="#ln-389"></a><span class="w">    </span><span class="k">END DO</span>
<a id="ln-390" name="ln-390" href="#ln-390"></a><span class="k">    DO </span><span class="n">yrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ydimsize</span><span class="w"></span>
<a id="ln-391" name="ln-391" href="#ln-391"></a><span class="w">       </span><span class="n">lon_all</span><span class="p">(:,</span><span class="n">yrow</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU_lons</span><span class="w"></span>
<a id="ln-392" name="ln-392" href="#ln-392"></a><span class="w">    </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-393" name="ln-393" href="#ln-393"></a>
<a id="ln-394" name="ln-394" href="#ln-394"></a><span class="w">    </span><span class="c">! CABLE TIME-UNITS needed by load-parameters (only on CABLE_init)</span>
<a id="ln-395" name="ln-395" href="#ln-395"></a><span class="w">    </span><span class="n">shod</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<a id="ln-396" name="ln-396" href="#ln-396"></a><span class="w">    </span><span class="n">sdoy</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-397" name="ln-397" href="#ln-397"></a><span class="w">    </span><span class="n">smoy</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-398" name="ln-398" href="#ln-398"></a><span class="w">    </span><span class="n">syear</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-399" name="ln-399" href="#ln-399"></a>
<a id="ln-400" name="ln-400" href="#ln-400"></a><span class="w">    </span><span class="c">! Used to rescale the diurnal cycle from Swinbank calculation to match CRU-NCEP provided value.</span>
<a id="ln-401" name="ln-401" href="#ln-401"></a><span class="w">    </span><span class="k">ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="p">(</span><span class="n">mland</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-402" name="ln-402" href="#ln-402"></a>
<a id="ln-403" name="ln-403" href="#ln-403"></a><span class="w">    </span><span class="k">DEALLOCATE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">landmask</span><span class="p">,</span><span class="w"> </span><span class="n">CRU_lats</span><span class="p">,</span><span class="w"> </span><span class="n">CRU_lons</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-404" name="ln-404" href="#ln-404"></a>
<a id="ln-405" name="ln-405" href="#ln-405"></a><span class="w">    </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_CLOSE</span><span class="p">(</span><span class="n">FID</span><span class="p">)</span><span class="w"></span>
<a id="ln-406" name="ln-406" href="#ln-406"></a><span class="w">    </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Closing mask-file&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">LandMaskFile</span><span class="p">))</span><span class="w"></span>
<a id="ln-407" name="ln-407" href="#ln-407"></a>
<a id="ln-408" name="ln-408" href="#ln-408"></a><span class="w">  </span><span class="k">END SUBROUTINE </span><span class="n">CRU_INIT</span><span class="w"></span>
<a id="ln-409" name="ln-409" href="#ln-409"></a>
<a id="ln-410" name="ln-410" href="#ln-410"></a><span class="c">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a id="ln-411" name="ln-411" href="#ln-411"></a>
<a id="ln-412" name="ln-412" href="#ln-412"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">CRU_GET_FILENAME</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">cyear</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">,</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-413" name="ln-413" href="#ln-413"></a>
<a id="ln-414" name="ln-414" href="#ln-414"></a><span class="w">    </span><span class="c">! Build the filename FN: One annual file of daily met for one met quantity.</span>
<a id="ln-415" name="ln-415" href="#ln-415"></a>
<a id="ln-416" name="ln-416" href="#ln-416"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-417" name="ln-417" href="#ln-417"></a>
<a id="ln-418" name="ln-418" href="#ln-418"></a><span class="k">    TYPE</span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w">  </span><span class="c">! Information about CRU</span>
<a id="ln-419" name="ln-419" href="#ln-419"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w">              </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">cyear</span><span class="w">  </span><span class="c">! Current year as an integer</span>
<a id="ln-420" name="ln-420" href="#ln-420"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w">              </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">par</span><span class="w">    </span><span class="c">! Index (1-9) of which met quantity will be sought</span>
<a id="ln-421" name="ln-421" href="#ln-421"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span><span class="w">   </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">FN</span><span class="w">     </span><span class="c">! Met filename (outgoing)</span>
<a id="ln-422" name="ln-422" href="#ln-422"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="w"></span>
<a id="ln-423" name="ln-423" href="#ln-423"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">cy</span><span class="w">  </span><span class="c">! Character representation of cyear</span>
<a id="ln-424" name="ln-424" href="#ln-424"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mp</span><span class="w">  </span><span class="c">! Local repr of met path</span>
<a id="ln-425" name="ln-425" href="#ln-425"></a>
<a id="ln-426" name="ln-426" href="#ln-426"></a><span class="w">    </span><span class="c">! Create a character version of the year for building that part of the filename.</span>
<a id="ln-427" name="ln-427" href="#ln-427"></a><span class="w">    </span><span class="k">WRITE</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">FMT</span><span class="o">=</span><span class="s1">&#39;(I4)&#39;</span><span class="p">)</span><span class="n">cyear</span><span class="w"></span>
<a id="ln-428" name="ln-428" href="#ln-428"></a>
<a id="ln-429" name="ln-429" href="#ln-429"></a><span class="w">    </span><span class="c">! Initialise the filename with the met path</span>
<a id="ln-430" name="ln-430" href="#ln-430"></a><span class="w">    </span><span class="n">mp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MetPath</span><span class="w"></span>
<a id="ln-431" name="ln-431" href="#ln-431"></a><span class="w">    </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span><span class="w"></span>
<a id="ln-432" name="ln-432" href="#ln-432"></a>
<a id="ln-433" name="ln-433" href="#ln-433"></a><span class="w">    </span><span class="c">! Build the rest of the filename according to the value of par, which references 11 possible</span>
<a id="ln-434" name="ln-434" href="#ln-434"></a><span class="w">    </span><span class="c">! types of met through the parameter names rain, lwdn, etc.</span>
<a id="ln-435" name="ln-435" href="#ln-435"></a><span class="c">!!$    SELECT CASE ( par )</span>
<a id="ln-436" name="ln-436" href="#ln-436"></a><span class="c">!!$    CASE(rain) ; FN = TRIM(FN)//&quot;/rain/cruncep2015_1_rain_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-437" name="ln-437" href="#ln-437"></a><span class="c">!!$    CASE(lwdn) ; FN = TRIM(FN)//&quot;/lwdown/cruncep2015_1_lwdown_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-438" name="ln-438" href="#ln-438"></a><span class="c">!!$    CASE(swdn) ; FN = TRIM(FN)//&quot;/swdown/cruncep2015_1_swdown_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-439" name="ln-439" href="#ln-439"></a><span class="c">!!$    CASE(pres) ; FN = TRIM(FN)//&quot;/press/cruncep2015_1_press_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-440" name="ln-440" href="#ln-440"></a><span class="c">!!$    CASE(qair) ; FN = TRIM(FN)//&quot;/qair/cruncep2015_1_qair_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-441" name="ln-441" href="#ln-441"></a><span class="c">!!$    CASE(tmax,PrevTmax) ; FN = TRIM(FN)//&quot;/tmax/cruncep2015_1_tair_&quot;//cy//&quot;.daymax.nc&quot;</span>
<a id="ln-442" name="ln-442" href="#ln-442"></a><span class="c">!!$    CASE(tmin,NextTmin) ; FN = TRIM(FN)//&quot;/tmin/cruncep2015_1_tair_&quot;//cy//&quot;.daymin.nc&quot;</span>
<a id="ln-443" name="ln-443" href="#ln-443"></a><span class="c">!!$    CASE(uwind) ; FN = TRIM(FN)//&quot;/uwind/cruncep2015_1_uwind_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-444" name="ln-444" href="#ln-444"></a><span class="c">!!$    CASE(vwind) ; FN = TRIM(FN)//&quot;/vwind/cruncep2015_1_vwind_&quot;//cy//&quot;.daymean.nc&quot;</span>
<a id="ln-445" name="ln-445" href="#ln-445"></a><span class="c">!!$    END SELECT</span>
<a id="ln-446" name="ln-446" href="#ln-446"></a>
<a id="ln-447" name="ln-447" href="#ln-447"></a>
<a id="ln-448" name="ln-448" href="#ln-448"></a><span class="w">    </span><span class="k">SELECT CASE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">par</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-449" name="ln-449" href="#ln-449"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">rain</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/rain/cruncepV8_rain_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daytot.nc&quot;</span><span class="w"></span>
<a id="ln-450" name="ln-450" href="#ln-450"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">lwdn</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/lwdown/cruncepV8_lwdown_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-451" name="ln-451" href="#ln-451"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">swdn</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/swdown/cruncepV8_swdown_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-452" name="ln-452" href="#ln-452"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">pres</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/press/cruncepV8_press_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-453" name="ln-453" href="#ln-453"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">qair</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/qair/cruncepV8_qair_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-454" name="ln-454" href="#ln-454"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">tmax</span><span class="p">,</span><span class="n">PrevTmax</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/tmax/cruncepV8_tmax_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymax.nc&quot;</span><span class="w"></span>
<a id="ln-455" name="ln-455" href="#ln-455"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">tmin</span><span class="p">,</span><span class="n">NextTmin</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/tmin/cruncepV8_tmin_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymin.nc&quot;</span><span class="w"></span>
<a id="ln-456" name="ln-456" href="#ln-456"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">uwind</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/uwind/cruncepV8_uwind_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-457" name="ln-457" href="#ln-457"></a><span class="w">    </span><span class="k">CASE</span><span class="p">(</span><span class="n">vwind</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">FN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">FN</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/vwind/cruncepV8_vwind_&quot;</span><span class="o">//</span><span class="n">cy</span><span class="o">//</span><span class="s2">&quot;.daymean.nc&quot;</span><span class="w"></span>
<a id="ln-458" name="ln-458" href="#ln-458"></a><span class="w">    </span><span class="k">END SELECT</span>
<a id="ln-459" name="ln-459" href="#ln-459"></a>
<a id="ln-460" name="ln-460" href="#ln-460"></a><span class="k">  END SUBROUTINE </span><span class="n">CRU_GET_FILENAME</span><span class="w"></span>
<a id="ln-461" name="ln-461" href="#ln-461"></a>
<a id="ln-462" name="ln-462" href="#ln-462"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-463" name="ln-463" href="#ln-463"></a>
<a id="ln-464" name="ln-464" href="#ln-464"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">GET_CRU_CO2</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">CO2air</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-465" name="ln-465" href="#ln-465"></a>
<a id="ln-466" name="ln-466" href="#ln-466"></a><span class="w">    </span><span class="c">! Get CO2 values for use with a CRU-NCEP run. Assign a static 1860 value if specified otherwise</span>
<a id="ln-467" name="ln-467" href="#ln-467"></a><span class="w">    </span><span class="c">! on the first call read all the annual values from a file into the CRU%CO2VALS array. On the first</span>
<a id="ln-468" name="ln-468" href="#ln-468"></a><span class="w">    </span><span class="c">! and subsequent</span>
<a id="ln-469" name="ln-469" href="#ln-469"></a>
<a id="ln-470" name="ln-470" href="#ln-470"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-471" name="ln-471" href="#ln-471"></a>
<a id="ln-472" name="ln-472" href="#ln-472"></a><span class="k">    TYPE</span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w">           </span><span class="c">! All the info needed for CRU met runs</span>
<a id="ln-473" name="ln-473" href="#ln-473"></a><span class="w">    </span><span class="kt">REAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">CO2air</span><span class="w">  </span><span class="c">! A single annual value of CO2air in ppm for the current year.</span>
<a id="ln-474" name="ln-474" href="#ln-474"></a>
<a id="ln-475" name="ln-475" href="#ln-475"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">iunit</span><span class="p">,</span><span class="w"> </span><span class="n">iyear</span><span class="p">,</span><span class="w"> </span><span class="n">IOS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-476" name="ln-476" href="#ln-476"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">CO2FILE</span><span class="o">*</span><span class="mi">200</span><span class="w"></span>
<a id="ln-477" name="ln-477" href="#ln-477"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w">        </span><span class="k">SAVE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w">  </span><span class="c">! A *local* variable recording the first call of this routine</span>
<a id="ln-478" name="ln-478" href="#ln-478"></a>
<a id="ln-479" name="ln-479" href="#ln-479"></a><span class="w">    </span><span class="c">! For S0_TRENDY, use only static 1860 CO2 value and return immediately</span>
<a id="ln-480" name="ln-480" href="#ln-480"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-481" name="ln-481" href="#ln-481"></a><span class="k">       </span><span class="n">CO2air</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">28</span><span class="mf">6.42</span><span class="w">   </span><span class="c">! CO2 in ppm for 1860</span>
<a id="ln-482" name="ln-482" href="#ln-482"></a><span class="w">       </span><span class="k">RETURN</span><span class="w"></span>
<a id="ln-483" name="ln-483" href="#ln-483"></a>
<a id="ln-484" name="ln-484" href="#ln-484"></a><span class="w">       </span><span class="c">! If not S0_TRENDY, varying CO2 values will be used...</span>
<a id="ln-485" name="ln-485" href="#ln-485"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"></span>
<a id="ln-486" name="ln-486" href="#ln-486"></a>
<a id="ln-487" name="ln-487" href="#ln-487"></a><span class="w">       </span><span class="c">! On the first call, allocate the CRU%CO2VALS array to store the entire history of annual CO2</span>
<a id="ln-488" name="ln-488" href="#ln-488"></a><span class="w">       </span><span class="c">! values, open the (ascii) CO2 file and read the values into the array.</span>
<a id="ln-489" name="ln-489" href="#ln-489"></a><span class="w">       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-490" name="ln-490" href="#ln-490"></a><span class="k">          ALLOCATE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2VALS</span><span class="p">(</span><span class="w"> </span><span class="mi">1750</span><span class="p">:</span><span class="mi">2016</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-491" name="ln-491" href="#ln-491"></a><span class="w">          </span><span class="n">CO2FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">BasePath</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;/co2/1750_2015_globalCO2_time_series.csv&quot;</span><span class="w"></span>
<a id="ln-492" name="ln-492" href="#ln-492"></a><span class="w">          </span><span class="k">CALL </span><span class="n">GET_UNIT</span><span class="p">(</span><span class="n">iunit</span><span class="p">)</span><span class="w"></span>
<a id="ln-493" name="ln-493" href="#ln-493"></a><span class="w">          </span><span class="k">OPEN</span><span class="w"> </span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="w"> </span><span class="k">FILE</span><span class="o">=</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CO2FILE</span><span class="p">),</span><span class="w"> </span><span class="n">STATUS</span><span class="o">=</span><span class="s2">&quot;OLD&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ACTION</span><span class="o">=</span><span class="s2">&quot;READ&quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-494" name="ln-494" href="#ln-494"></a><span class="w">          </span><span class="k">DO WHILE</span><span class="p">(</span><span class="w"> </span><span class="n">IOS</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-495" name="ln-495" href="#ln-495"></a><span class="w">             </span><span class="k">READ</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="w"> </span><span class="n">FMT</span><span class="o">=*</span><span class="p">,</span><span class="w"> </span><span class="n">IOSTAT</span><span class="o">=</span><span class="n">IOS</span><span class="p">)</span><span class="w"> </span><span class="n">iyear</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2VALS</span><span class="p">(</span><span class="n">iyear</span><span class="p">)</span><span class="w"></span>
<a id="ln-496" name="ln-496" href="#ln-496"></a><span class="w">          </span><span class="k">END DO</span>
<a id="ln-497" name="ln-497" href="#ln-497"></a><span class="k">          CLOSE</span><span class="p">(</span><span class="n">iunit</span><span class="p">)</span><span class="w"></span>
<a id="ln-498" name="ln-498" href="#ln-498"></a>
<a id="ln-499" name="ln-499" href="#ln-499"></a><span class="w">          </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-500" name="ln-500" href="#ln-500"></a>
<a id="ln-501" name="ln-501" href="#ln-501"></a><span class="w">       </span><span class="k">END IF</span><span class="w"></span>
<a id="ln-502" name="ln-502" href="#ln-502"></a>
<a id="ln-503" name="ln-503" href="#ln-503"></a><span class="w">       </span><span class="c">! In all varying CO2 cases, return the element of the array for the current year</span>
<a id="ln-504" name="ln-504" href="#ln-504"></a><span class="w">       </span><span class="c">! as a single CO2 value.</span>
<a id="ln-505" name="ln-505" href="#ln-505"></a><span class="w">       </span><span class="c">!</span>
<a id="ln-506" name="ln-506" href="#ln-506"></a><span class="w">       </span><span class="n">CO2air</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CO2VALS</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-507" name="ln-507" href="#ln-507"></a>
<a id="ln-508" name="ln-508" href="#ln-508"></a><span class="w">    </span><span class="k">END IF</span>
<a id="ln-509" name="ln-509" href="#ln-509"></a>
<a id="ln-510" name="ln-510" href="#ln-510"></a><span class="k">  END SUBROUTINE </span><span class="n">GET_CRU_CO2</span><span class="w"></span>
<a id="ln-511" name="ln-511" href="#ln-511"></a>
<a id="ln-512" name="ln-512" href="#ln-512"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-513" name="ln-513" href="#ln-513"></a>
<a id="ln-514" name="ln-514" href="#ln-514"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">GET_CRU_Ndep</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-515" name="ln-515" href="#ln-515"></a>
<a id="ln-516" name="ln-516" href="#ln-516"></a><span class="w">    </span><span class="c">! Get Ndep values for use with a CRU-NCEP run. Assign a static 1860 value if specified otherwise</span>
<a id="ln-517" name="ln-517" href="#ln-517"></a><span class="w">    </span><span class="c">! on the first call read all the annual values from a file into the CRU%CO2VALS array. On the first</span>
<a id="ln-518" name="ln-518" href="#ln-518"></a><span class="w">    </span><span class="c">! and subsequent</span>
<a id="ln-519" name="ln-519" href="#ln-519"></a>
<a id="ln-520" name="ln-520" href="#ln-520"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-521" name="ln-521" href="#ln-521"></a>
<a id="ln-522" name="ln-522" href="#ln-522"></a><span class="k">    TYPE</span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w">           </span><span class="c">! All the info needed for CRU met runs</span>
<a id="ln-523" name="ln-523" href="#ln-523"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="mi">720</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span><span class="w">        </span><span class="c">! Temporary array for reading one day of met before</span>
<a id="ln-524" name="ln-524" href="#ln-524"></a><span class="w">    </span><span class="c">! packing into CRU%NdepVALS(k)</span>
<a id="ln-525" name="ln-525" href="#ln-525"></a>
<a id="ln-526" name="ln-526" href="#ln-526"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">iunit</span><span class="p">,</span><span class="w"> </span><span class="n">iyear</span><span class="p">,</span><span class="w"> </span><span class="n">IOS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"></span>
<a id="ln-527" name="ln-527" href="#ln-527"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xds</span><span class="p">,</span><span class="w"> </span><span class="n">yds</span><span class="w">        </span><span class="c">! Ndep file dimensions of long (x), lat (y)</span>
<a id="ln-528" name="ln-528" href="#ln-528"></a>
<a id="ln-529" name="ln-529" href="#ln-529"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w">        </span><span class="k">SAVE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w">  </span><span class="c">! A *local* variable recording the first call of this routine</span>
<a id="ln-530" name="ln-530" href="#ln-530"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NdepFILE</span><span class="w"></span>
<a id="ln-531" name="ln-531" href="#ln-531"></a>
<a id="ln-532" name="ln-532" href="#ln-532"></a><span class="w">    </span><span class="c">! Abbreviate dimensions for readability.</span>
<a id="ln-533" name="ln-533" href="#ln-533"></a><span class="w">    </span><span class="n">xds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">xdimsize</span><span class="w"></span>
<a id="ln-534" name="ln-534" href="#ln-534"></a><span class="w">    </span><span class="n">yds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">ydimsize</span><span class="w"></span>
<a id="ln-535" name="ln-535" href="#ln-535"></a>
<a id="ln-536" name="ln-536" href="#ln-536"></a><span class="w">    </span><span class="c">! For S0_TRENDY, use only static 1860 CO2 value and return immediately</span>
<a id="ln-537" name="ln-537" href="#ln-537"></a>
<a id="ln-538" name="ln-538" href="#ln-538"></a>
<a id="ln-539" name="ln-539" href="#ln-539"></a>
<a id="ln-540" name="ln-540" href="#ln-540"></a><span class="w">    </span><span class="c">! On the first call, allocate the CRU%CO2VALS array to store the entire history of annual CO2</span>
<a id="ln-541" name="ln-541" href="#ln-541"></a><span class="w">    </span><span class="c">! values, open the (ascii) CO2 file and read the values into the array.</span>
<a id="ln-542" name="ln-542" href="#ln-542"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-543" name="ln-543" href="#ln-543"></a>
<a id="ln-544" name="ln-544" href="#ln-544"></a><span class="k">       </span><span class="n">NdepFILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">BasePath</span><span class="p">)</span><span class="o">//</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-545" name="ln-545" href="#ln-545"></a><span class="w">            </span><span class="s2">&quot;/ndep/NOy_plus_NHx_dry_plus_wet_deposition_hist_1850_2015_annual.nc&quot;</span><span class="w"></span>
<a id="ln-546" name="ln-546" href="#ln-546"></a>
<a id="ln-547" name="ln-547" href="#ln-547"></a><span class="w">       </span><span class="c">! Open the NDep and access the variables by their name and variable id.</span>
<a id="ln-548" name="ln-548" href="#ln-548"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening ndep data file: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">NdepFILE</span><span class="w"></span>
<a id="ln-549" name="ln-549" href="#ln-549"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening ndep data file: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">NdepFILE</span><span class="w"></span>
<a id="ln-550" name="ln-550" href="#ln-550"></a>
<a id="ln-551" name="ln-551" href="#ln-551"></a>
<a id="ln-552" name="ln-552" href="#ln-552"></a><span class="w">       </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">NdepFILE</span><span class="p">),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepF_ID</span><span class="p">)</span><span class="w"></span>
<a id="ln-553" name="ln-553" href="#ln-553"></a><span class="w">       </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU file &quot;</span><span class="o">//</span><span class="n">NdepFILE</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-554" name="ln-554" href="#ln-554"></a><span class="w">       </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepF_ID</span><span class="p">,</span><span class="s1">&#39;N_deposition&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepV_ID</span><span class="p">)</span><span class="w"></span>
<a id="ln-555" name="ln-555" href="#ln-555"></a><span class="w">       </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring CRU var &quot;</span><span class="o">//</span><span class="s2">&quot;N_deposition&quot;</span><span class="o">//</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-556" name="ln-556" href="#ln-556"></a><span class="w">            </span><span class="s2">&quot; in &quot;</span><span class="o">//</span><span class="n">NdepFILE</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-557" name="ln-557" href="#ln-557"></a>
<a id="ln-558" name="ln-558" href="#ln-558"></a><span class="w">       </span><span class="c">! Set internal counter</span>
<a id="ln-559" name="ln-559" href="#ln-559"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep_CTSTEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-560" name="ln-560" href="#ln-560"></a>
<a id="ln-561" name="ln-561" href="#ln-561"></a><span class="w">       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-562" name="ln-562" href="#ln-562"></a><span class="w">          </span><span class="c">! read Ndep at year 1860 (noting that file starts at 1850)</span>
<a id="ln-563" name="ln-563" href="#ln-563"></a><span class="w">          </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep_CTSTEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<a id="ln-564" name="ln-564" href="#ln-564"></a><span class="w">          </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep_CTSTEP</span><span class="w"></span>
<a id="ln-565" name="ln-565" href="#ln-565"></a><span class="w">          </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepF_ID</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepV_ID</span><span class="p">,</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-566" name="ln-566" href="#ln-566"></a><span class="w">               </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-567" name="ln-567" href="#ln-567"></a><span class="w">          </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">NdepFILE</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-568" name="ln-568" href="#ln-568"></a><span class="w">          </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-569" name="ln-569" href="#ln-569"></a><span class="w">             </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-570" name="ln-570" href="#ln-570"></a><span class="w">          </span><span class="k">END DO</span>
<a id="ln-571" name="ln-571" href="#ln-571"></a>
<a id="ln-572" name="ln-572" href="#ln-572"></a>
<a id="ln-573" name="ln-573" href="#ln-573"></a><span class="k">       END IF</span>
<a id="ln-574" name="ln-574" href="#ln-574"></a><span class="k">       </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-575" name="ln-575" href="#ln-575"></a><span class="w">    </span><span class="k">END IF</span>
<a id="ln-576" name="ln-576" href="#ln-576"></a>
<a id="ln-577" name="ln-577" href="#ln-577"></a><span class="k">    IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="w"> </span><span class="s2">&quot;static1860&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-578" name="ln-578" href="#ln-578"></a>
<a id="ln-579" name="ln-579" href="#ln-579"></a><span class="w">       </span><span class="c">! read Ndep at current year (noting that file starts at 1850 and ends in 2015)</span>
<a id="ln-580" name="ln-580" href="#ln-580"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep_CTSTEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="p">,</span><span class="w"> </span><span class="mi">2015</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1850</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-581" name="ln-581" href="#ln-581"></a><span class="w">       </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CRU</span><span class="p">%</span><span class="n">Ndep_CTSTEP</span><span class="w"></span>
<a id="ln-582" name="ln-582" href="#ln-582"></a><span class="w">       </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepF_ID</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepV_ID</span><span class="p">,</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-583" name="ln-583" href="#ln-583"></a><span class="w">            </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-584" name="ln-584" href="#ln-584"></a><span class="w">       </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">NdepFILE</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-585" name="ln-585" href="#ln-585"></a><span class="w">       </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-586" name="ln-586" href="#ln-586"></a><span class="w">          </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-587" name="ln-587" href="#ln-587"></a><span class="w">       </span><span class="k">END DO</span>
<a id="ln-588" name="ln-588" href="#ln-588"></a>
<a id="ln-589" name="ln-589" href="#ln-589"></a><span class="k">    END IF</span>
<a id="ln-590" name="ln-590" href="#ln-590"></a>
<a id="ln-591" name="ln-591" href="#ln-591"></a>
<a id="ln-592" name="ln-592" href="#ln-592"></a>
<a id="ln-593" name="ln-593" href="#ln-593"></a>
<a id="ln-594" name="ln-594" href="#ln-594"></a>
<a id="ln-595" name="ln-595" href="#ln-595"></a><span class="k">  END SUBROUTINE </span><span class="n">GET_CRU_Ndep</span><span class="w"></span>
<a id="ln-596" name="ln-596" href="#ln-596"></a>
<a id="ln-597" name="ln-597" href="#ln-597"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-598" name="ln-598" href="#ln-598"></a>
<a id="ln-599" name="ln-599" href="#ln-599"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">OPEN_CRU_MET</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-600" name="ln-600" href="#ln-600"></a>
<a id="ln-601" name="ln-601" href="#ln-601"></a><span class="w">    </span><span class="c">! Opens each of the met files required for one year. This is where the distinction is made between</span>
<a id="ln-602" name="ln-602" href="#ln-602"></a><span class="w">    </span><span class="c">! the nominal run year (CYEAR) and the year of met required (MetYear), which is different for</span>
<a id="ln-603" name="ln-603" href="#ln-603"></a><span class="w">    </span><span class="c">! S0_TRENDY and S1_TRENDY than for a standard run (S2_TRENDY).</span>
<a id="ln-604" name="ln-604" href="#ln-604"></a>
<a id="ln-605" name="ln-605" href="#ln-605"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_IO_vars_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">timeunits</span><span class="w"> </span><span class="c">! (Char33) Name of time units read from nc file</span>
<a id="ln-606" name="ln-606" href="#ln-606"></a>
<a id="ln-607" name="ln-607" href="#ln-607"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-608" name="ln-608" href="#ln-608"></a>
<a id="ln-609" name="ln-609" href="#ln-609"></a><span class="k">    TYPE</span><span class="p">(</span><span class="w"> </span><span class="n">CRU_TYPE</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">INOUT</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="c">! All CRU-NCEP related quantities and flags</span>
<a id="ln-610" name="ln-610" href="#ln-610"></a>
<a id="ln-611" name="ln-611" href="#ln-611"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">iVar</span><span class="w">            </span><span class="c">! Loop counter through met variables</span>
<a id="ln-612" name="ln-612" href="#ln-612"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">tID</span><span class="w">             </span><span class="c">! Numerical variable identifier returned by NetCDF routines,</span>
<a id="ln-613" name="ln-613" href="#ln-613"></a><span class="w">    </span><span class="c">! in this case for time. Needed to retrieve the time units.</span>
<a id="ln-614" name="ln-614" href="#ln-614"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">MetYear</span><span class="w">         </span><span class="c">! Year of met to access. Equals CYEAR for normal runs, but</span>
<a id="ln-615" name="ln-615" href="#ln-615"></a><span class="w">    </span><span class="c">! must be calculated for S0_TRENDY and initialisation runs.</span>
<a id="ln-616" name="ln-616" href="#ln-616"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">RunStartYear</span><span class="w">    </span><span class="c">! The value of CRU%CYEAR on the first call, also equals syear.</span>
<a id="ln-617" name="ln-617" href="#ln-617"></a><span class="w">    </span><span class="c">! Allows the calculation of MetYear during S0_TRENDY and init runs.</span>
<a id="ln-618" name="ln-618" href="#ln-618"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w">  </span><span class="c">! A *local* variable recording the first call of this routine</span>
<a id="ln-619" name="ln-619" href="#ln-619"></a>
<a id="ln-620" name="ln-620" href="#ln-620"></a><span class="w">    </span><span class="c">! Keep the initial value of CYEAR for calculation of different MetYear if required.</span>
<a id="ln-621" name="ln-621" href="#ln-621"></a><span class="w">    </span><span class="c">!IF (CALL1) RunStartYear = 1710 ! edit vh !</span>
<a id="ln-622" name="ln-622" href="#ln-622"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="n">RunStartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1691</span><span class="w"> </span><span class="c">! edit vh !</span>
<a id="ln-623" name="ln-623" href="#ln-623"></a><span class="w">    </span><span class="k">DO </span><span class="n">iVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NMET</span><span class="w">  </span><span class="c">! For each met variable</span>
<a id="ln-624" name="ln-624" href="#ln-624"></a>
<a id="ln-625" name="ln-625" href="#ln-625"></a><span class="w">       </span><span class="c">! For S0_TRENDY and initialisation, calculate the required met year for repeatedly cycling through the</span>
<a id="ln-626" name="ln-626" href="#ln-626"></a><span class="w">       </span><span class="c">! 30 years of 1901-1930 spinup meteorology. For normal runs 1901-2015, MetYear = CYEAR.</span>
<a id="ln-627" name="ln-627" href="#ln-627"></a><span class="c">!!$    IF ( TRIM(CRU%Run) .EQ. &#39;S0_TRENDY&#39; .OR.  ( TRIM(CRU%Run) .EQ. &#39;S1_TRENDY&#39; )) THEN</span>
<a id="ln-628" name="ln-628" href="#ln-628"></a><span class="c">!!$      MetYear = 1901 + MOD(CRU%CYEAR-RunStartYear,30)</span>
<a id="ln-629" name="ln-629" href="#ln-629"></a><span class="c">!!$    ELSE IF ( TRIM(CRU%Run) .EQ. &#39;S2_TRENDY&#39; ) THEN</span>
<a id="ln-630" name="ln-630" href="#ln-630"></a><span class="c">!!$      MetYear = CRU%CYEAR</span>
<a id="ln-631" name="ln-631" href="#ln-631"></a><span class="c">!!$    ENDIF</span>
<a id="ln-632" name="ln-632" href="#ln-632"></a><span class="w">       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S1_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-633" name="ln-633" href="#ln-633"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-634" name="ln-634" href="#ln-634"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Ndep&#39;</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-635" name="ln-635" href="#ln-635"></a><span class="k">          </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-636" name="ln-636" href="#ln-636"></a><span class="w">       </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Precip&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-637" name="ln-637" href="#ln-637"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-638" name="ln-638" href="#ln-638"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-639" name="ln-639" href="#ln-639"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-640" name="ln-640" href="#ln-640"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-641" name="ln-641" href="#ln-641"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-642" name="ln-642" href="#ln-642"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-643" name="ln-643" href="#ln-643"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-644" name="ln-644" href="#ln-644"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-645" name="ln-645" href="#ln-645"></a>
<a id="ln-646" name="ln-646" href="#ln-646"></a><span class="k">          IF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-647" name="ln-647" href="#ln-647"></a><span class="w">               </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-648" name="ln-648" href="#ln-648"></a><span class="k">             IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-649" name="ln-649" href="#ln-649"></a><span class="k">                </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-650" name="ln-650" href="#ln-650"></a><span class="w">             </span><span class="k">ELSE</span>
<a id="ln-651" name="ln-651" href="#ln-651"></a><span class="k">                </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-652" name="ln-652" href="#ln-652"></a><span class="w">             </span><span class="k">ENDIF</span>
<a id="ln-653" name="ln-653" href="#ln-653"></a><span class="k">          ENDIF</span>
<a id="ln-654" name="ln-654" href="#ln-654"></a>
<a id="ln-655" name="ln-655" href="#ln-655"></a><span class="k">       </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-656" name="ln-656" href="#ln-656"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-657" name="ln-657" href="#ln-657"></a>
<a id="ln-658" name="ln-658" href="#ln-658"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-659" name="ln-659" href="#ln-659"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-660" name="ln-660" href="#ln-660"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-661" name="ln-661" href="#ln-661"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-662" name="ln-662" href="#ln-662"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-663" name="ln-663" href="#ln-663"></a><span class="k">       ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-664" name="ln-664" href="#ln-664"></a><span class="k">          </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-665" name="ln-665" href="#ln-665"></a><span class="w">       </span><span class="k">ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip0&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-666" name="ln-666" href="#ln-666"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-667" name="ln-667" href="#ln-667"></a><span class="w">             </span><span class="c">! special for baseline precip</span>
<a id="ln-668" name="ln-668" href="#ln-668"></a><span class="w">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-669" name="ln-669" href="#ln-669"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-670" name="ln-670" href="#ln-670"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-671" name="ln-671" href="#ln-671"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-672" name="ln-672" href="#ln-672"></a><span class="k">       ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-673" name="ln-673" href="#ln-673"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-674" name="ln-674" href="#ln-674"></a><span class="w">             </span><span class="c">! special for baseline non-precip</span>
<a id="ln-675" name="ln-675" href="#ln-675"></a><span class="w">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-676" name="ln-676" href="#ln-676"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-677" name="ln-677" href="#ln-677"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-678" name="ln-678" href="#ln-678"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-679" name="ln-679" href="#ln-679"></a><span class="k">       ENDIF</span>
<a id="ln-680" name="ln-680" href="#ln-680"></a>
<a id="ln-681" name="ln-681" href="#ln-681"></a><span class="k">       CALL </span><span class="n">CRU_GET_FILENAME</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">MetYear</span><span class="p">,</span><span class="w"> </span><span class="n">iVar</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c">! Call routine to build the filenames.</span>
<a id="ln-682" name="ln-682" href="#ln-682"></a>
<a id="ln-683" name="ln-683" href="#ln-683"></a><span class="w">       </span><span class="c">! Open the new met files and access the variables by their name and variable id.</span>
<a id="ln-684" name="ln-684" href="#ln-684"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="w">   </span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening met data file: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"></span>
<a id="ln-685" name="ln-685" href="#ln-685"></a><span class="w">       </span><span class="k">WRITE</span><span class="p">(</span><span class="n">logn</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Opening met data file: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"></span>
<a id="ln-686" name="ln-686" href="#ln-686"></a>
<a id="ln-687" name="ln-687" href="#ln-687"></a><span class="w">       </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">))</span><span class="w"></span>
<a id="ln-688" name="ln-688" href="#ln-688"></a><span class="w">       </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU file &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-689" name="ln-689" href="#ln-689"></a><span class="w">       </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">iVar</span><span class="p">)),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">))</span><span class="w"></span>
<a id="ln-690" name="ln-690" href="#ln-690"></a><span class="w">       </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring CRU var &quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">iVar</span><span class="p">))</span><span class="o">//</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-691" name="ln-691" href="#ln-691"></a><span class="w">            </span><span class="s2">&quot; in &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-692" name="ln-692" href="#ln-692"></a><span class="w">    </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-693" name="ln-693" href="#ln-693"></a>
<a id="ln-694" name="ln-694" href="#ln-694"></a><span class="w">    </span><span class="c">! Set internal counter</span>
<a id="ln-695" name="ln-695" href="#ln-695"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-696" name="ln-696" href="#ln-696"></a>
<a id="ln-697" name="ln-697" href="#ln-697"></a><span class="w">    </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"> </span><span class="c">! No longer the first call (saved).</span>
<a id="ln-698" name="ln-698" href="#ln-698"></a>
<a id="ln-699" name="ln-699" href="#ln-699"></a><span class="w">  </span><span class="k">END SUBROUTINE </span><span class="n">OPEN_CRU_MET</span><span class="w"></span>
<a id="ln-700" name="ln-700" href="#ln-700"></a>
<a id="ln-701" name="ln-701" href="#ln-701"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-702" name="ln-702" href="#ln-702"></a>
<a id="ln-703" name="ln-703" href="#ln-703"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">CRU_GET_DAILY_MET</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="p">,</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-704" name="ln-704" href="#ln-704"></a>
<a id="ln-705" name="ln-705" href="#ln-705"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-706" name="ln-706" href="#ln-706"></a>
<a id="ln-707" name="ln-707" href="#ln-707"></a><span class="k">    TYPE</span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w"></span>
<a id="ln-708" name="ln-708" href="#ln-708"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="p">,</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"></span>
<a id="ln-709" name="ln-709" href="#ln-709"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="mi">720</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span><span class="w">        </span><span class="c">! Temporary array for reading one day of met before</span>
<a id="ln-710" name="ln-710" href="#ln-710"></a><span class="w">    </span><span class="c">! packing into CRU%MET(iVar)%METVALS(k)</span>
<a id="ln-711" name="ln-711" href="#ln-711"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">tmp</span><span class="p">,</span><span class="w"> </span><span class="n">stmp</span><span class="p">(</span><span class="mi">365</span><span class="p">)</span><span class="w"></span>
<a id="ln-712" name="ln-712" href="#ln-712"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iVar</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">realk</span><span class="w"></span>
<a id="ln-713" name="ln-713" href="#ln-713"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">tplus1</span><span class="w">              </span><span class="c">! The current and next timestep</span>
<a id="ln-714" name="ln-714" href="#ln-714"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">tid</span><span class="w">          </span><span class="c">! Netcdf id&#39;s for file, variable, and time</span>
<a id="ln-715" name="ln-715" href="#ln-715"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">xds</span><span class="p">,</span><span class="w"> </span><span class="n">yds</span><span class="p">,</span><span class="w"> </span><span class="n">tds</span><span class="w">          </span><span class="c">! Metfile dimensions of long (x), lat (y), and time (t)</span>
<a id="ln-716" name="ln-716" href="#ln-716"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MetYear</span><span class="w">                </span><span class="c">! Year of meteorology currently in use</span>
<a id="ln-717" name="ln-717" href="#ln-717"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">NextMetYear</span><span class="w">            </span><span class="c">! Next met year: Where to look for the nextTmin on Dec 31st</span>
<a id="ln-718" name="ln-718" href="#ln-718"></a><span class="w">    </span><span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<a id="ln-719" name="ln-719" href="#ln-719"></a>
<a id="ln-720" name="ln-720" href="#ln-720"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">RunStartYear</span><span class="w">    </span><span class="c">! The value of CRU%CYEAR on the first call, also equals syear.</span>
<a id="ln-721" name="ln-721" href="#ln-721"></a><span class="w">    </span><span class="c">! Allows the calculation of MetYear during S0_TRENDY and init runs.</span>
<a id="ln-722" name="ln-722" href="#ln-722"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="k">SAVE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w">   </span><span class="c">! A *local* variable recording the first call of this routine</span>
<a id="ln-723" name="ln-723" href="#ln-723"></a>
<a id="ln-724" name="ln-724" href="#ln-724"></a>
<a id="ln-725" name="ln-725" href="#ln-725"></a><span class="w">    </span><span class="c">! If first call...</span>
<a id="ln-726" name="ln-726" href="#ln-726"></a><span class="w">    </span><span class="c">! Keep the initial value of CYEAR for calculation of different MetYear if required.</span>
<a id="ln-727" name="ln-727" href="#ln-727"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-728" name="ln-728" href="#ln-728"></a><span class="w">       </span><span class="c">!RunStartYear = CRU%CYEAR</span>
<a id="ln-729" name="ln-729" href="#ln-729"></a><span class="w">       </span><span class="n">RunStartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1691</span><span class="w"></span>
<a id="ln-730" name="ln-730" href="#ln-730"></a><span class="w">       </span><span class="c">! If this is not the first call, capture the existing Tmax from the previous day as the</span>
<a id="ln-731" name="ln-731" href="#ln-731"></a><span class="w">       </span><span class="c">! &#39;previous Tmax&#39; before reading another one. Move the existing next day&#39;s Tmin into the current</span>
<a id="ln-732" name="ln-732" href="#ln-732"></a><span class="w">       </span><span class="c">! Tmin before reading a new &#39;next Tmin&#39;. These previous and next values are required for the</span>
<a id="ln-733" name="ln-733" href="#ln-733"></a><span class="w">       </span><span class="c">! Cesaraccio et al. algorithm used by the weather generator to interpolate daily into subdiurnal</span>
<a id="ln-734" name="ln-734" href="#ln-734"></a><span class="w">       </span><span class="c">! temperatures.</span>
<a id="ln-735" name="ln-735" href="#ln-735"></a><span class="w">    </span><span class="k">ELSE</span>
<a id="ln-736" name="ln-736" href="#ln-736"></a><span class="k">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">prevTmax</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">Tmax</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-737" name="ln-737" href="#ln-737"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">Tmin</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">NextTmin</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-738" name="ln-738" href="#ln-738"></a><span class="w">    </span><span class="k">ENDIF</span><span class="w"></span>
<a id="ln-739" name="ln-739" href="#ln-739"></a>
<a id="ln-740" name="ln-740" href="#ln-740"></a><span class="w">    </span><span class="c">! For S0_TRENDY and initialisation, calculate the year of meteorology as mod 50, so we repeatedly cycle</span>
<a id="ln-741" name="ln-741" href="#ln-741"></a><span class="w">    </span><span class="c">! through the 50 years of 1951-2000 spinup meteorology. For normal runs 1901-2015, MetYear = CYEAR.</span>
<a id="ln-742" name="ln-742" href="#ln-742"></a><span class="w">    </span><span class="c">! Stop with error for anything else.</span>
<a id="ln-743" name="ln-743" href="#ln-743"></a>
<a id="ln-744" name="ln-744" href="#ln-744"></a>
<a id="ln-745" name="ln-745" href="#ln-745"></a><span class="c">!!$  IF ( TRIM(CRU%Run) .EQ. &#39;S0_TRENDY&#39; .OR.  ( TRIM(CRU%Run) .EQ. &#39;S1_TRENDY&#39; )) THEN</span>
<a id="ln-746" name="ln-746" href="#ln-746"></a><span class="c">!!$    MetYear = 1901 + MOD(CRU%CYEAR-RunStartYear,30)</span>
<a id="ln-747" name="ln-747" href="#ln-747"></a><span class="c">!!$  ELSE IF ( TRIM(CRU%Run) .EQ. &#39;S2_TRENDY&#39; ) THEN</span>
<a id="ln-748" name="ln-748" href="#ln-748"></a><span class="c">!!$    MetYear = CRU%CYEAR</span>
<a id="ln-749" name="ln-749" href="#ln-749"></a><span class="c">!!$  ELSE</span>
<a id="ln-750" name="ln-750" href="#ln-750"></a><span class="c">!!$    STOP &#39;Error in cable_cru.F90: CRU%Run not S0_TRENDY, S1_TRENDY, or 1901-2015&#39;</span>
<a id="ln-751" name="ln-751" href="#ln-751"></a><span class="c">!!$  ENDIF</span>
<a id="ln-752" name="ln-752" href="#ln-752"></a>
<a id="ln-753" name="ln-753" href="#ln-753"></a><span class="w">    </span><span class="c">!print *, &quot;runstartyear, metyear&quot;, runstartyear, metyear</span>
<a id="ln-754" name="ln-754" href="#ln-754"></a>
<a id="ln-755" name="ln-755" href="#ln-755"></a><span class="w">    </span><span class="c">! Abbreviate dimensions for readability.</span>
<a id="ln-756" name="ln-756" href="#ln-756"></a><span class="w">    </span><span class="n">xds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">xdimsize</span><span class="w"></span>
<a id="ln-757" name="ln-757" href="#ln-757"></a><span class="w">    </span><span class="n">yds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">ydimsize</span><span class="w"></span>
<a id="ln-758" name="ln-758" href="#ln-758"></a>
<a id="ln-759" name="ln-759" href="#ln-759"></a><span class="w">    </span><span class="c">! Loop through all 9 met variables (not including prevTmax and nextTmin, which are addressed</span>
<a id="ln-760" name="ln-760" href="#ln-760"></a><span class="w">    </span><span class="c">! separately as special cases of Tmax and Tmin)</span>
<a id="ln-761" name="ln-761" href="#ln-761"></a>
<a id="ln-762" name="ln-762" href="#ln-762"></a><span class="w">    </span><span class="c">!print *,  &quot;CRU%CTSTEP, LastDayOfYear, LastYearOfMet&quot;, CRU%CTSTEP, LastDayOfYear, LastYearOfMet</span>
<a id="ln-763" name="ln-763" href="#ln-763"></a><span class="w">    </span><span class="k">DO </span><span class="n">iVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NMET</span><span class="w"></span>
<a id="ln-764" name="ln-764" href="#ln-764"></a>
<a id="ln-765" name="ln-765" href="#ln-765"></a><span class="w">       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S1_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-766" name="ln-766" href="#ln-766"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-767" name="ln-767" href="#ln-767"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Ndep&#39;</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-768" name="ln-768" href="#ln-768"></a><span class="k">          </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-769" name="ln-769" href="#ln-769"></a><span class="w">       </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Precip&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-770" name="ln-770" href="#ln-770"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-771" name="ln-771" href="#ln-771"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-772" name="ln-772" href="#ln-772"></a><span class="w">            </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-773" name="ln-773" href="#ln-773"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-774" name="ln-774" href="#ln-774"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-775" name="ln-775" href="#ln-775"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-776" name="ln-776" href="#ln-776"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-777" name="ln-777" href="#ln-777"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-778" name="ln-778" href="#ln-778"></a><span class="k">          IF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-779" name="ln-779" href="#ln-779"></a><span class="w">               </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-780" name="ln-780" href="#ln-780"></a><span class="k">             IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-781" name="ln-781" href="#ln-781"></a><span class="k">                </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-782" name="ln-782" href="#ln-782"></a><span class="w">             </span><span class="k">ELSE</span>
<a id="ln-783" name="ln-783" href="#ln-783"></a><span class="k">                </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-784" name="ln-784" href="#ln-784"></a><span class="w">             </span><span class="k">ENDIF</span>
<a id="ln-785" name="ln-785" href="#ln-785"></a><span class="k">          ENDIF</span>
<a id="ln-786" name="ln-786" href="#ln-786"></a>
<a id="ln-787" name="ln-787" href="#ln-787"></a><span class="k">       </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-788" name="ln-788" href="#ln-788"></a><span class="w">            </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-789" name="ln-789" href="#ln-789"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-790" name="ln-790" href="#ln-790"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-791" name="ln-791" href="#ln-791"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-792" name="ln-792" href="#ln-792"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-793" name="ln-793" href="#ln-793"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-794" name="ln-794" href="#ln-794"></a><span class="k">       ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-795" name="ln-795" href="#ln-795"></a><span class="k">          </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-796" name="ln-796" href="#ln-796"></a><span class="w">       </span><span class="k">ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip0&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-797" name="ln-797" href="#ln-797"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-798" name="ln-798" href="#ln-798"></a><span class="w">             </span><span class="c">! special for baseline precip</span>
<a id="ln-799" name="ln-799" href="#ln-799"></a><span class="w">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-800" name="ln-800" href="#ln-800"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-801" name="ln-801" href="#ln-801"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-802" name="ln-802" href="#ln-802"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-803" name="ln-803" href="#ln-803"></a><span class="k">       ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-804" name="ln-804" href="#ln-804"></a><span class="k">          IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-805" name="ln-805" href="#ln-805"></a><span class="w">             </span><span class="c">! special for baseline non-precip</span>
<a id="ln-806" name="ln-806" href="#ln-806"></a><span class="w">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-807" name="ln-807" href="#ln-807"></a><span class="w">          </span><span class="k">ELSE</span>
<a id="ln-808" name="ln-808" href="#ln-808"></a><span class="k">             </span><span class="n">MetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-809" name="ln-809" href="#ln-809"></a><span class="w">          </span><span class="k">ENDIF</span>
<a id="ln-810" name="ln-810" href="#ln-810"></a><span class="k">       ENDIF</span>
<a id="ln-811" name="ln-811" href="#ln-811"></a>
<a id="ln-812" name="ln-812" href="#ln-812"></a>
<a id="ln-813" name="ln-813" href="#ln-813"></a><span class="k">       SELECT CASE</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"></span>
<a id="ln-814" name="ln-814" href="#ln-814"></a>
<a id="ln-815" name="ln-815" href="#ln-815"></a><span class="w">          </span><span class="c">!--------------------------------------------------------------------------------------------------</span>
<a id="ln-816" name="ln-816" href="#ln-816"></a>
<a id="ln-817" name="ln-817" href="#ln-817"></a><span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="p">(</span><span class="n">Tmin</span><span class="p">)</span><span class="w"> </span><span class="c">! When Tmin comes up we will jump ahead to deal with nextTmin, since we</span>
<a id="ln-818" name="ln-818" href="#ln-818"></a><span class="w">          </span><span class="c">! are assigning Tmin from the previous value of nextTmin</span>
<a id="ln-819" name="ln-819" href="#ln-819"></a>
<a id="ln-820" name="ln-820" href="#ln-820"></a><span class="w">          </span><span class="c">! Bump the variable index ii to be the value for nextTmin and the time index ahead by 1 day.</span>
<a id="ln-821" name="ln-821" href="#ln-821"></a><span class="w">          </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextTmin</span><span class="w"></span>
<a id="ln-822" name="ln-822" href="#ln-822"></a><span class="w">          </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"></span>
<a id="ln-823" name="ln-823" href="#ln-823"></a><span class="w">          </span><span class="n">tplus1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-824" name="ln-824" href="#ln-824"></a>
<a id="ln-825" name="ln-825" href="#ln-825"></a><span class="w">          </span><span class="c">! The first call exception for Tmin is to read both the first (t) and second (t+1) timesteps.</span>
<a id="ln-826" name="ln-826" href="#ln-826"></a><span class="w">          </span><span class="c">! The first goes into Tmin, the second into nextTmin.</span>
<a id="ln-827" name="ln-827" href="#ln-827"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-828" name="ln-828" href="#ln-828"></a>
<a id="ln-829" name="ln-829" href="#ln-829"></a><span class="w">             </span><span class="c">! In the case of a small number of points, it is more efficient to pull the data for each land point</span>
<a id="ln-830" name="ln-830" href="#ln-830"></a><span class="w">             </span><span class="c">! directly from the file (DirectRead) rather than reading the whole array and extracting the land</span>
<a id="ln-831" name="ln-831" href="#ln-831"></a><span class="w">             </span><span class="c">! points from that.</span>
<a id="ln-832" name="ln-832" href="#ln-832"></a><span class="w">             </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-833" name="ln-833" href="#ln-833"></a>
<a id="ln-834" name="ln-834" href="#ln-834"></a><span class="w">                </span><span class="c">! For each land cell, read the first day value of Tmin into tmp, and copy it to the METVALS vector.</span>
<a id="ln-835" name="ln-835" href="#ln-835"></a>
<a id="ln-836" name="ln-836" href="#ln-836"></a><span class="w">                </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-837" name="ln-837" href="#ln-837"></a>
<a id="ln-838" name="ln-838" href="#ln-838"></a><span class="w">                   </span><span class="c">! t (first value) into iVar (tmin)</span>
<a id="ln-839" name="ln-839" href="#ln-839"></a><span class="w">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmp</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-840" name="ln-840" href="#ln-840"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-841" name="ln-841" href="#ln-841"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading direct from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-842" name="ln-842" href="#ln-842"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="w"></span>
<a id="ln-843" name="ln-843" href="#ln-843"></a>
<a id="ln-844" name="ln-844" href="#ln-844"></a><span class="w">                   </span><span class="c">! tplus1 (second value) into ii (nextTmin)</span>
<a id="ln-845" name="ln-845" href="#ln-845"></a><span class="w">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmp</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-846" name="ln-846" href="#ln-846"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">tplus1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-847" name="ln-847" href="#ln-847"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading direct from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-848" name="ln-848" href="#ln-848"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="w"></span>
<a id="ln-849" name="ln-849" href="#ln-849"></a>
<a id="ln-850" name="ln-850" href="#ln-850"></a><span class="w">                </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-851" name="ln-851" href="#ln-851"></a>
<a id="ln-852" name="ln-852" href="#ln-852"></a><span class="w">                </span><span class="c">! Not DirectRead: Read the whole spatial grid of first day Tmin into tmparr, and copy it to the</span>
<a id="ln-853" name="ln-853" href="#ln-853"></a><span class="w">                </span><span class="c">! METVALS vector.</span>
<a id="ln-854" name="ln-854" href="#ln-854"></a><span class="w">             </span><span class="k">ELSE</span><span class="w"></span>
<a id="ln-855" name="ln-855" href="#ln-855"></a>
<a id="ln-856" name="ln-856" href="#ln-856"></a><span class="w">                </span><span class="c">! t (first value) into iVar (tmin)</span>
<a id="ln-857" name="ln-857" href="#ln-857"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-858" name="ln-858" href="#ln-858"></a><span class="w">                     </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-859" name="ln-859" href="#ln-859"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-860" name="ln-860" href="#ln-860"></a>
<a id="ln-861" name="ln-861" href="#ln-861"></a><span class="w">                </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-862" name="ln-862" href="#ln-862"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-863" name="ln-863" href="#ln-863"></a><span class="w">                </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-864" name="ln-864" href="#ln-864"></a>
<a id="ln-865" name="ln-865" href="#ln-865"></a><span class="w">                </span><span class="c">! tplus1 (second value) into ii (nextTmin)</span>
<a id="ln-866" name="ln-866" href="#ln-866"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-867" name="ln-867" href="#ln-867"></a><span class="w">                     </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tplus1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-868" name="ln-868" href="#ln-868"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-869" name="ln-869" href="#ln-869"></a>
<a id="ln-870" name="ln-870" href="#ln-870"></a><span class="w">                </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-871" name="ln-871" href="#ln-871"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-872" name="ln-872" href="#ln-872"></a><span class="w">                </span><span class="k">END DO</span>
<a id="ln-873" name="ln-873" href="#ln-873"></a>
<a id="ln-874" name="ln-874" href="#ln-874"></a><span class="k">             ENDIF</span><span class="w">  </span><span class="c">! End of if DirectRead</span>
<a id="ln-875" name="ln-875" href="#ln-875"></a>
<a id="ln-876" name="ln-876" href="#ln-876"></a><span class="w">          </span><span class="k">END IF</span><span class="w">   </span><span class="c">! End of if CALL1</span>
<a id="ln-877" name="ln-877" href="#ln-877"></a>
<a id="ln-878" name="ln-878" href="#ln-878"></a><span class="w">          </span><span class="c">! If this is the last day of the year we will need to get the nextTmin</span>
<a id="ln-879" name="ln-879" href="#ln-879"></a><span class="w">          </span><span class="c">! value from the next year&#39;s met file.</span>
<a id="ln-880" name="ln-880" href="#ln-880"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-881" name="ln-881" href="#ln-881"></a>
<a id="ln-882" name="ln-882" href="#ln-882"></a><span class="k">             IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">  </span><span class="c">! If there is no more met to open...</span>
<a id="ln-883" name="ln-883" href="#ln-883"></a>
<a id="ln-884" name="ln-884" href="#ln-884"></a><span class="w">                </span><span class="k">CONTINUE</span><span class="w"> </span><span class="c">! Do nothing. The current value of nextTmin will just be reused.</span>
<a id="ln-885" name="ln-885" href="#ln-885"></a>
<a id="ln-886" name="ln-886" href="#ln-886"></a><span class="w">             </span><span class="k">ELSE</span><span class="w">  </span><span class="c">! There is another year of Tmin data available</span>
<a id="ln-887" name="ln-887" href="#ln-887"></a>
<a id="ln-888" name="ln-888" href="#ln-888"></a><span class="w">                </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">   </span><span class="c">! Time index is set to the first day of the next year</span>
<a id="ln-889" name="ln-889" href="#ln-889"></a>
<a id="ln-890" name="ln-890" href="#ln-890"></a><span class="w">                </span><span class="c">! Add one to the calculation of MetYear</span>
<a id="ln-891" name="ln-891" href="#ln-891"></a><span class="c">!!$          IF ( TRIM(CRU%Run) .EQ. &#39;S0_TRENDY&#39; .OR.  ( TRIM(CRU%Run) .EQ. &#39;S1_TRENDY&#39; )) THEN</span>
<a id="ln-892" name="ln-892" href="#ln-892"></a><span class="c">!!$            NextMetYear = 1901 + MOD(CRU%CYEAR + 1 - RunStartYear,30)</span>
<a id="ln-893" name="ln-893" href="#ln-893"></a><span class="c">!!$          ELSE IF ( TRIM(CRU%Run) .EQ. &#39;S2_TRENDY&#39; ) THEN</span>
<a id="ln-894" name="ln-894" href="#ln-894"></a><span class="c">!!$            NextMetYear = CRU%CYEAR + 1</span>
<a id="ln-895" name="ln-895" href="#ln-895"></a><span class="c">!!$          ENDIF</span>
<a id="ln-896" name="ln-896" href="#ln-896"></a><span class="w">                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S1_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-897" name="ln-897" href="#ln-897"></a><span class="w">                     </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-898" name="ln-898" href="#ln-898"></a><span class="w">                     </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Ndep&#39;</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-899" name="ln-899" href="#ln-899"></a><span class="k">                   </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-900" name="ln-900" href="#ln-900"></a><span class="w">                </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Precip&#39;</span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-901" name="ln-901" href="#ln-901"></a><span class="w">                     </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Precip&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-902" name="ln-902" href="#ln-902"></a><span class="w">                     </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-903" name="ln-903" href="#ln-903"></a><span class="w">                     </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-904" name="ln-904" href="#ln-904"></a><span class="k">                   IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-905" name="ln-905" href="#ln-905"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-906" name="ln-906" href="#ln-906"></a><span class="w">                   </span><span class="k">ELSE</span>
<a id="ln-907" name="ln-907" href="#ln-907"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-908" name="ln-908" href="#ln-908"></a><span class="w">                   </span><span class="k">ENDIF</span>
<a id="ln-909" name="ln-909" href="#ln-909"></a><span class="k">                   IF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp_Precip&#39;</span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-910" name="ln-910" href="#ln-910"></a><span class="w">                        </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp_Precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-911" name="ln-911" href="#ln-911"></a><span class="k">                      IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-912" name="ln-912" href="#ln-912"></a><span class="k">                         </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-913" name="ln-913" href="#ln-913"></a><span class="w">                      </span><span class="k">ELSE</span>
<a id="ln-914" name="ln-914" href="#ln-914"></a><span class="k">                         </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-915" name="ln-915" href="#ln-915"></a><span class="w">                      </span><span class="k">ENDIF</span>
<a id="ln-916" name="ln-916" href="#ln-916"></a><span class="k">                   ENDIF</span>
<a id="ln-917" name="ln-917" href="#ln-917"></a>
<a id="ln-918" name="ln-918" href="#ln-918"></a>
<a id="ln-919" name="ln-919" href="#ln-919"></a><span class="k">                </span><span class="n">ELSEIF</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_Temp&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-920" name="ln-920" href="#ln-920"></a><span class="w">                     </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">  </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S0_TRENDY_CO2_Temp&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-921" name="ln-921" href="#ln-921"></a><span class="k">                   IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">6</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-922" name="ln-922" href="#ln-922"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-923" name="ln-923" href="#ln-923"></a><span class="w">                   </span><span class="k">ELSE</span>
<a id="ln-924" name="ln-924" href="#ln-924"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-925" name="ln-925" href="#ln-925"></a><span class="w">                   </span><span class="k">ENDIF</span>
<a id="ln-926" name="ln-926" href="#ln-926"></a><span class="k">                ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-927" name="ln-927" href="#ln-927"></a><span class="k">                   </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-928" name="ln-928" href="#ln-928"></a><span class="w">                </span><span class="k">ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip0&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-929" name="ln-929" href="#ln-929"></a><span class="k">                   IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-930" name="ln-930" href="#ln-930"></a><span class="w">                      </span><span class="c">! special for baseline precip</span>
<a id="ln-931" name="ln-931" href="#ln-931"></a><span class="w">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-932" name="ln-932" href="#ln-932"></a><span class="w">                   </span><span class="k">ELSE</span>
<a id="ln-933" name="ln-933" href="#ln-933"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-934" name="ln-934" href="#ln-934"></a><span class="w">                   </span><span class="k">ENDIF</span>
<a id="ln-935" name="ln-935" href="#ln-935"></a><span class="k">                ELSE IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">Run</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;S2_TRENDY_precip&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-936" name="ln-936" href="#ln-936"></a><span class="k">                   IF</span><span class="w"> </span><span class="p">(</span><span class="n">iVar</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-937" name="ln-937" href="#ln-937"></a><span class="w">                      </span><span class="c">! special for baseline non-precip</span>
<a id="ln-938" name="ln-938" href="#ln-938"></a><span class="w">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="o">-</span><span class="n">RunStartYear</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<a id="ln-939" name="ln-939" href="#ln-939"></a><span class="w">                   </span><span class="k">ELSE</span>
<a id="ln-940" name="ln-940" href="#ln-940"></a><span class="k">                      </span><span class="n">NextMetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"></span>
<a id="ln-941" name="ln-941" href="#ln-941"></a><span class="w">                   </span><span class="k">ENDIF</span>
<a id="ln-942" name="ln-942" href="#ln-942"></a><span class="k">                ENDIF</span><span class="w"></span>
<a id="ln-943" name="ln-943" href="#ln-943"></a>
<a id="ln-944" name="ln-944" href="#ln-944"></a><span class="w">                </span><span class="c">! Open the Tmin file for next year in preparation for reading Jan 1st...</span>
<a id="ln-945" name="ln-945" href="#ln-945"></a><span class="w">                </span><span class="k">CALL </span><span class="n">CRU_GET_FILENAME</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">NextMetYear</span><span class="p">,</span><span class="w"> </span><span class="n">Tmin</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-946" name="ln-946" href="#ln-946"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">fid</span><span class="p">)</span><span class="w"></span>
<a id="ln-947" name="ln-947" href="#ln-947"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU file &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-948" name="ln-948" href="#ln-948"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">iVar</span><span class="p">)),</span><span class="w"> </span><span class="n">vid</span><span class="p">)</span><span class="w"></span>
<a id="ln-949" name="ln-949" href="#ln-949"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring CRU var &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-950" name="ln-950" href="#ln-950"></a>
<a id="ln-951" name="ln-951" href="#ln-951"></a>
<a id="ln-952" name="ln-952" href="#ln-952"></a><span class="w">                </span><span class="c">! If DirectRead is specified (small domain) pull the points directly from the file.</span>
<a id="ln-953" name="ln-953" href="#ln-953"></a><span class="w">                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-954" name="ln-954" href="#ln-954"></a>
<a id="ln-955" name="ln-955" href="#ln-955"></a><span class="k">                   DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-956" name="ln-956" href="#ln-956"></a><span class="w">                      </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w">  </span><span class="c">! Values to ii (nextTmin)</span>
<a id="ln-957" name="ln-957" href="#ln-957"></a><span class="w">                           </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-958" name="ln-958" href="#ln-958"></a><span class="w">                      </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-959" name="ln-959" href="#ln-959"></a><span class="w">                   </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-960" name="ln-960" href="#ln-960"></a>
<a id="ln-961" name="ln-961" href="#ln-961"></a><span class="w">                   </span><span class="c">! Else not DirectRead: Read full grid into temp array and extract domain from that.</span>
<a id="ln-962" name="ln-962" href="#ln-962"></a><span class="w">                </span><span class="k">ELSE</span>
<a id="ln-963" name="ln-963" href="#ln-963"></a>
<a id="ln-964" name="ln-964" href="#ln-964"></a><span class="k">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-965" name="ln-965" href="#ln-965"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-966" name="ln-966" href="#ln-966"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-967" name="ln-967" href="#ln-967"></a><span class="w">                   </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-968" name="ln-968" href="#ln-968"></a><span class="w">                      </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="c">! Values to ii (nextTmin)</span>
<a id="ln-969" name="ln-969" href="#ln-969"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-970" name="ln-970" href="#ln-970"></a>
<a id="ln-971" name="ln-971" href="#ln-971"></a><span class="k">                ENDIF</span><span class="w">  </span><span class="c">! End of If DirectRead</span>
<a id="ln-972" name="ln-972" href="#ln-972"></a>
<a id="ln-973" name="ln-973" href="#ln-973"></a><span class="w">                </span><span class="c">! Close the next year&#39;s Tmin met file</span>
<a id="ln-974" name="ln-974" href="#ln-974"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_CLOSE</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span><span class="w"></span>
<a id="ln-975" name="ln-975" href="#ln-975"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Closing CRU file &quot;</span><span class="o">//</span><span class="n">filename</span><span class="p">)</span><span class="w"></span>
<a id="ln-976" name="ln-976" href="#ln-976"></a>
<a id="ln-977" name="ln-977" href="#ln-977"></a><span class="w">             </span><span class="k">ENDIF</span><span class="w"> </span><span class="c">! End of If LastYearOfMet</span>
<a id="ln-978" name="ln-978" href="#ln-978"></a>
<a id="ln-979" name="ln-979" href="#ln-979"></a><span class="w">          </span><span class="k">END IF</span><span class="w">  </span><span class="c">! End of If LastDayOfYear</span>
<a id="ln-980" name="ln-980" href="#ln-980"></a>
<a id="ln-981" name="ln-981" href="#ln-981"></a><span class="w">          </span><span class="c">! If this is not the first call or last day of the year (i.e. somewhere in the middle)</span>
<a id="ln-982" name="ln-982" href="#ln-982"></a><span class="w">          </span><span class="c">! Just read the next timestep (tplus1) of Tmin data (iVar) into the nextTmin (ii) variable.</span>
<a id="ln-983" name="ln-983" href="#ln-983"></a>
<a id="ln-984" name="ln-984" href="#ln-984"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">((.</span><span class="nb">NOT</span><span class="p">.</span><span class="w"> </span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-985" name="ln-985" href="#ln-985"></a><span class="k">             IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-986" name="ln-986" href="#ln-986"></a>
<a id="ln-987" name="ln-987" href="#ln-987"></a><span class="k">                DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-988" name="ln-988" href="#ln-988"></a><span class="w">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-989" name="ln-989" href="#ln-989"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">tplus1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-990" name="ln-990" href="#ln-990"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-991" name="ln-991" href="#ln-991"></a><span class="w">                </span><span class="k">END DO</span>
<a id="ln-992" name="ln-992" href="#ln-992"></a>
<a id="ln-993" name="ln-993" href="#ln-993"></a><span class="k">             ELSE</span>
<a id="ln-994" name="ln-994" href="#ln-994"></a>
<a id="ln-995" name="ln-995" href="#ln-995"></a><span class="k">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-996" name="ln-996" href="#ln-996"></a><span class="w">                     </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tplus1</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-997" name="ln-997" href="#ln-997"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-998" name="ln-998" href="#ln-998"></a><span class="w">                </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-999" name="ln-999" href="#ln-999"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1000" name="ln-1000" href="#ln-1000"></a><span class="w">                </span><span class="k">END DO</span>
<a id="ln-1001" name="ln-1001" href="#ln-1001"></a><span class="k">             ENDIF</span>
<a id="ln-1002" name="ln-1002" href="#ln-1002"></a><span class="k">          END IF</span><span class="w"></span>
<a id="ln-1003" name="ln-1003" href="#ln-1003"></a>
<a id="ln-1004" name="ln-1004" href="#ln-1004"></a><span class="w">          </span><span class="c">!--------------------------------------------------------------------------------------------------</span>
<a id="ln-1005" name="ln-1005" href="#ln-1005"></a>
<a id="ln-1006" name="ln-1006" href="#ln-1006"></a><span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="p">(</span><span class="n">TMax</span><span class="p">)</span><span class="w"></span>
<a id="ln-1007" name="ln-1007" href="#ln-1007"></a>
<a id="ln-1008" name="ln-1008" href="#ln-1008"></a><span class="w">          </span><span class="c">! For Tmax, we need the previous day&#39;s Tmax for the Cesaraccio et al subdiurnal</span>
<a id="ln-1009" name="ln-1009" href="#ln-1009"></a><span class="w">          </span><span class="c">! temperature interpolation algorithm.</span>
<a id="ln-1010" name="ln-1010" href="#ln-1010"></a>
<a id="ln-1011" name="ln-1011" href="#ln-1011"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">   </span><span class="c">! On the first day of the run...</span>
<a id="ln-1012" name="ln-1012" href="#ln-1012"></a>
<a id="ln-1013" name="ln-1013" href="#ln-1013"></a><span class="w">             </span><span class="c">! Assign the met variable index to be prevTmax. iVar will still refer to Tmax.</span>
<a id="ln-1014" name="ln-1014" href="#ln-1014"></a><span class="w">             </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prevTmax</span><span class="w"></span>
<a id="ln-1015" name="ln-1015" href="#ln-1015"></a>
<a id="ln-1016" name="ln-1016" href="#ln-1016"></a><span class="w">             </span><span class="c">! If the very first MetYear is more than 1901, there is a previous year of Tmax data available.</span>
<a id="ln-1017" name="ln-1017" href="#ln-1017"></a><span class="w">             </span><span class="c">! such as during spinups, when the starting year is 1951.</span>
<a id="ln-1018" name="ln-1018" href="#ln-1018"></a><span class="w">             </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">MetYear</span><span class="w"> </span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="w"> </span><span class="mi">1901</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-1019" name="ln-1019" href="#ln-1019"></a>
<a id="ln-1020" name="ln-1020" href="#ln-1020"></a><span class="w">                </span><span class="c">! Open the previous year&#39;s Tmax file (MetYear-1)</span>
<a id="ln-1021" name="ln-1021" href="#ln-1021"></a><span class="w">                </span><span class="k">CALL </span><span class="n">CRU_GET_FILENAME</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">MetYear</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iVar</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1022" name="ln-1022" href="#ln-1022"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">fid</span><span class="p">)</span><span class="w"></span>
<a id="ln-1023" name="ln-1023" href="#ln-1023"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU file &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1024" name="ln-1024" href="#ln-1024"></a>
<a id="ln-1025" name="ln-1025" href="#ln-1025"></a><span class="w">                </span><span class="c">! Obtain the size of the time dimension (tds), which locates the data for Dec 31st in the file.</span>
<a id="ln-1026" name="ln-1026" href="#ln-1026"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_DIMID</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">tid</span><span class="p">)</span><span class="w"></span>
<a id="ln-1027" name="ln-1027" href="#ln-1027"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQUIRE_DIMENSION</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="n">tid</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">tds</span><span class="p">)</span><span class="w"></span>
<a id="ln-1028" name="ln-1028" href="#ln-1028"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring &#39;time&#39;&quot;</span><span class="o">//</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="w"></span>
<a id="ln-1029" name="ln-1029" href="#ln-1029"></a>
<a id="ln-1030" name="ln-1030" href="#ln-1030"></a><span class="w">                </span><span class="c">! Obtain the variable ID of the Tmax variable.</span>
<a id="ln-1031" name="ln-1031" href="#ln-1031"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_INQ_VARID</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">VAR_NAME</span><span class="p">(</span><span class="n">iVar</span><span class="p">)),</span><span class="w"> </span><span class="n">vid</span><span class="p">)</span><span class="w"></span>
<a id="ln-1032" name="ln-1032" href="#ln-1032"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Inquiring CRU var &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1033" name="ln-1033" href="#ln-1033"></a>
<a id="ln-1034" name="ln-1034" href="#ln-1034"></a><span class="w">                </span><span class="c">! If DirectRead is specified (small domain) pull the data for Dec 31st (tds) directly from the file.</span>
<a id="ln-1035" name="ln-1035" href="#ln-1035"></a><span class="w">                </span><span class="c">! Otherwise, read the whole Dec 31st grid into tmparr and pack the land points from there.</span>
<a id="ln-1036" name="ln-1036" href="#ln-1036"></a><span class="w">                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-1037" name="ln-1037" href="#ln-1037"></a><span class="w">                   </span><span class="c">!print *,&quot;about to read last value of MetYear-1 &quot;, MetYear - 1, trim(filename)</span>
<a id="ln-1038" name="ln-1038" href="#ln-1038"></a><span class="w">                   </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1039" name="ln-1039" href="#ln-1039"></a><span class="w">                      </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1040" name="ln-1040" href="#ln-1040"></a><span class="w">                           </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">tds</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1041" name="ln-1041" href="#ln-1041"></a><span class="w">                      </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1042" name="ln-1042" href="#ln-1042"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1043" name="ln-1043" href="#ln-1043"></a>
<a id="ln-1044" name="ln-1044" href="#ln-1044"></a><span class="k">                ELSE</span>
<a id="ln-1045" name="ln-1045" href="#ln-1045"></a>
<a id="ln-1046" name="ln-1046" href="#ln-1046"></a><span class="k">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="w"> </span><span class="n">vid</span><span class="p">,</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1047" name="ln-1047" href="#ln-1047"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tds</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1048" name="ln-1048" href="#ln-1048"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1049" name="ln-1049" href="#ln-1049"></a>
<a id="ln-1050" name="ln-1050" href="#ln-1050"></a><span class="w">                   </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1051" name="ln-1051" href="#ln-1051"></a><span class="w">                      </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1052" name="ln-1052" href="#ln-1052"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1053" name="ln-1053" href="#ln-1053"></a>
<a id="ln-1054" name="ln-1054" href="#ln-1054"></a><span class="k">                ENDIF</span><span class="w">  </span><span class="c">! End of If DirectRead</span>
<a id="ln-1055" name="ln-1055" href="#ln-1055"></a>
<a id="ln-1056" name="ln-1056" href="#ln-1056"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_CLOSE</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span><span class="w"></span>
<a id="ln-1057" name="ln-1057" href="#ln-1057"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Closing CRU file &quot;</span><span class="o">//</span><span class="n">filename</span><span class="p">)</span><span class="w"></span>
<a id="ln-1058" name="ln-1058" href="#ln-1058"></a>
<a id="ln-1059" name="ln-1059" href="#ln-1059"></a><span class="w">                </span><span class="c">! Having read the last day of the previous year&#39;s Tmax into prevTmax, and closed the file,</span>
<a id="ln-1060" name="ln-1060" href="#ln-1060"></a><span class="w">                </span><span class="c">! now read the first day of Tmax from the current year&#39;s file (which is already open).</span>
<a id="ln-1061" name="ln-1061" href="#ln-1061"></a>
<a id="ln-1062" name="ln-1062" href="#ln-1062"></a><span class="w">                </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w">  </span><span class="c">! CRU%CTSTEP here should be 1 (?)</span>
<a id="ln-1063" name="ln-1063" href="#ln-1063"></a>
<a id="ln-1064" name="ln-1064" href="#ln-1064"></a><span class="w">                </span><span class="c">! Read the current points directly into the vector for small domains, or read the whole grid into tmparr</span>
<a id="ln-1065" name="ln-1065" href="#ln-1065"></a><span class="w">                </span><span class="c">! and extract them from there. Read the current timestep value into the iVar variable (Tmax).</span>
<a id="ln-1066" name="ln-1066" href="#ln-1066"></a><span class="w">                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1067" name="ln-1067" href="#ln-1067"></a>
<a id="ln-1068" name="ln-1068" href="#ln-1068"></a><span class="k">                   DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1069" name="ln-1069" href="#ln-1069"></a><span class="w">                      </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1070" name="ln-1070" href="#ln-1070"></a><span class="w">                           </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1071" name="ln-1071" href="#ln-1071"></a><span class="w">                      </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1072" name="ln-1072" href="#ln-1072"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1073" name="ln-1073" href="#ln-1073"></a>
<a id="ln-1074" name="ln-1074" href="#ln-1074"></a><span class="k">                ELSE</span>
<a id="ln-1075" name="ln-1075" href="#ln-1075"></a>
<a id="ln-1076" name="ln-1076" href="#ln-1076"></a><span class="k">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1077" name="ln-1077" href="#ln-1077"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1078" name="ln-1078" href="#ln-1078"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1079" name="ln-1079" href="#ln-1079"></a><span class="w">                   </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1080" name="ln-1080" href="#ln-1080"></a><span class="w">                      </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1081" name="ln-1081" href="#ln-1081"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1082" name="ln-1082" href="#ln-1082"></a><span class="k">                ENDIF</span>
<a id="ln-1083" name="ln-1083" href="#ln-1083"></a>
<a id="ln-1084" name="ln-1084" href="#ln-1084"></a><span class="k">             ELSE</span><span class="w"> </span><span class="c">! MetYear = 1901</span>
<a id="ln-1085" name="ln-1085" href="#ln-1085"></a>
<a id="ln-1086" name="ln-1086" href="#ln-1086"></a><span class="w">                </span><span class="c">! Where MetYear is 1901, there is no previous Tmax value available, so we read the</span>
<a id="ln-1087" name="ln-1087" href="#ln-1087"></a><span class="w">                </span><span class="c">! Jan 1 value into Tmax, then assign it to prevTmax as well</span>
<a id="ln-1088" name="ln-1088" href="#ln-1088"></a>
<a id="ln-1089" name="ln-1089" href="#ln-1089"></a><span class="w">                </span><span class="c">! Open the 1901 Tmax file (MetYear)</span>
<a id="ln-1090" name="ln-1090" href="#ln-1090"></a><span class="w">                </span><span class="k">CALL </span><span class="n">CRU_GET_FILENAME</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="mi">1901</span><span class="p">,</span><span class="w"> </span><span class="n">iVar</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1091" name="ln-1091" href="#ln-1091"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_OPEN</span><span class="p">(</span><span class="nb">TRIM</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="w"> </span><span class="n">NF90_NOWRITE</span><span class="p">,</span><span class="w"> </span><span class="n">fid</span><span class="p">)</span><span class="w"></span>
<a id="ln-1092" name="ln-1092" href="#ln-1092"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Opening CRU file &quot;</span><span class="o">//</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1093" name="ln-1093" href="#ln-1093"></a>
<a id="ln-1094" name="ln-1094" href="#ln-1094"></a><span class="w">                </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w">  </span><span class="c">! CRU%CTSTEP here should be 1 (?)</span>
<a id="ln-1095" name="ln-1095" href="#ln-1095"></a>
<a id="ln-1096" name="ln-1096" href="#ln-1096"></a><span class="w">                </span><span class="c">! Read the current points directly into the vector for small domains, or read the whole grid into tmparr</span>
<a id="ln-1097" name="ln-1097" href="#ln-1097"></a><span class="w">                </span><span class="c">! and extract them from there. Read the current timestep value into the iVar variable (Tmax).</span>
<a id="ln-1098" name="ln-1098" href="#ln-1098"></a><span class="w">                </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1099" name="ln-1099" href="#ln-1099"></a>
<a id="ln-1100" name="ln-1100" href="#ln-1100"></a><span class="k">                   DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1101" name="ln-1101" href="#ln-1101"></a><span class="w">                      </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1102" name="ln-1102" href="#ln-1102"></a><span class="w">                           </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1103" name="ln-1103" href="#ln-1103"></a><span class="w">                      </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1104" name="ln-1104" href="#ln-1104"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1105" name="ln-1105" href="#ln-1105"></a>
<a id="ln-1106" name="ln-1106" href="#ln-1106"></a><span class="k">                ELSE</span>
<a id="ln-1107" name="ln-1107" href="#ln-1107"></a>
<a id="ln-1108" name="ln-1108" href="#ln-1108"></a><span class="k">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1109" name="ln-1109" href="#ln-1109"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1110" name="ln-1110" href="#ln-1110"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1111" name="ln-1111" href="#ln-1111"></a><span class="w">                   </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1112" name="ln-1112" href="#ln-1112"></a><span class="w">                      </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1113" name="ln-1113" href="#ln-1113"></a><span class="w">                   </span><span class="k">END DO</span>
<a id="ln-1114" name="ln-1114" href="#ln-1114"></a><span class="k">                ENDIF</span><span class="w"></span>
<a id="ln-1115" name="ln-1115" href="#ln-1115"></a>
<a id="ln-1116" name="ln-1116" href="#ln-1116"></a><span class="w">                </span><span class="c">! Now set the value for prevTmax (ii) equal to the current value for Tmax.</span>
<a id="ln-1117" name="ln-1117" href="#ln-1117"></a><span class="w">                </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-1118" name="ln-1118" href="#ln-1118"></a>
<a id="ln-1119" name="ln-1119" href="#ln-1119"></a><span class="w">             </span><span class="k">ENDIF</span><span class="w">  </span><span class="c">! End of If MetYear &gt; 1901</span>
<a id="ln-1120" name="ln-1120" href="#ln-1120"></a>
<a id="ln-1121" name="ln-1121" href="#ln-1121"></a><span class="w">          </span><span class="k">ELSE</span><span class="w">  </span><span class="c">! Not CALL1</span>
<a id="ln-1122" name="ln-1122" href="#ln-1122"></a>
<a id="ln-1123" name="ln-1123" href="#ln-1123"></a><span class="w">             </span><span class="c">! This is not the first call, so the only thing remaining to do for Tmax is read the new value.</span>
<a id="ln-1124" name="ln-1124" href="#ln-1124"></a><span class="w">             </span><span class="c">! (Current Tmax was assigned to prevTmax at the top of the routine).</span>
<a id="ln-1125" name="ln-1125" href="#ln-1125"></a>
<a id="ln-1126" name="ln-1126" href="#ln-1126"></a><span class="w">             </span><span class="c">! Set the variable index to iVar (Tmax). The timestep is the current timestep.</span>
<a id="ln-1127" name="ln-1127" href="#ln-1127"></a><span class="w">             </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"></span>
<a id="ln-1128" name="ln-1128" href="#ln-1128"></a>
<a id="ln-1129" name="ln-1129" href="#ln-1129"></a><span class="w">             </span><span class="c">! Read the current points directly into the vector for small domains, or read the whole grid into tmparr</span>
<a id="ln-1130" name="ln-1130" href="#ln-1130"></a><span class="w">             </span><span class="c">! and extract them from there.</span>
<a id="ln-1131" name="ln-1131" href="#ln-1131"></a><span class="w">             </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1132" name="ln-1132" href="#ln-1132"></a>
<a id="ln-1133" name="ln-1133" href="#ln-1133"></a><span class="k">                DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1134" name="ln-1134" href="#ln-1134"></a><span class="w">                   </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1135" name="ln-1135" href="#ln-1135"></a><span class="w">                        </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1136" name="ln-1136" href="#ln-1136"></a><span class="w">                   </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1137" name="ln-1137" href="#ln-1137"></a><span class="w">                </span><span class="k">END DO</span>
<a id="ln-1138" name="ln-1138" href="#ln-1138"></a>
<a id="ln-1139" name="ln-1139" href="#ln-1139"></a><span class="k">             ELSE</span>
<a id="ln-1140" name="ln-1140" href="#ln-1140"></a>
<a id="ln-1141" name="ln-1141" href="#ln-1141"></a><span class="k">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1142" name="ln-1142" href="#ln-1142"></a><span class="w">                     </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1143" name="ln-1143" href="#ln-1143"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1144" name="ln-1144" href="#ln-1144"></a><span class="w">                </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1145" name="ln-1145" href="#ln-1145"></a><span class="w">                   </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">iVar</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1146" name="ln-1146" href="#ln-1146"></a><span class="w">                </span><span class="k">END DO</span>
<a id="ln-1147" name="ln-1147" href="#ln-1147"></a><span class="k">             ENDIF</span>
<a id="ln-1148" name="ln-1148" href="#ln-1148"></a>
<a id="ln-1149" name="ln-1149" href="#ln-1149"></a><span class="k">          END IF</span><span class="w">   </span><span class="c">! End of If CALL1</span>
<a id="ln-1150" name="ln-1150" href="#ln-1150"></a>
<a id="ln-1151" name="ln-1151" href="#ln-1151"></a><span class="w">          </span><span class="c">!--------------------------------------------------------------------------------------------------</span>
<a id="ln-1152" name="ln-1152" href="#ln-1152"></a>
<a id="ln-1153" name="ln-1153" href="#ln-1153"></a><span class="w">       </span><span class="k">CASE </span><span class="n">DEFAULT</span><span class="w">   </span><span class="c">! All variables other than Tmin or Tmax...</span>
<a id="ln-1154" name="ln-1154" href="#ln-1154"></a>
<a id="ln-1155" name="ln-1155" href="#ln-1155"></a><span class="w">          </span><span class="c">! iVar is not Tmin or Tmax so the variable index and timestep index are unchanged.</span>
<a id="ln-1156" name="ln-1156" href="#ln-1156"></a><span class="w">          </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iVar</span><span class="w"></span>
<a id="ln-1157" name="ln-1157" href="#ln-1157"></a><span class="w">          </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"></span>
<a id="ln-1158" name="ln-1158" href="#ln-1158"></a>
<a id="ln-1159" name="ln-1159" href="#ln-1159"></a><span class="w">          </span><span class="c">! Standard read of the current variable, for the current timestep:</span>
<a id="ln-1160" name="ln-1160" href="#ln-1160"></a><span class="w">          </span><span class="c">! Directly read the current points into the met vector (more efficient for small domains),</span>
<a id="ln-1161" name="ln-1161" href="#ln-1161"></a><span class="w">          </span><span class="c">! or read the whole grid into tmparr and extract them from there.</span>
<a id="ln-1162" name="ln-1162" href="#ln-1162"></a><span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DirectRead</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1163" name="ln-1163" href="#ln-1163"></a>
<a id="ln-1164" name="ln-1164" href="#ln-1164"></a><span class="k">             DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1165" name="ln-1165" href="#ln-1165"></a><span class="w">                </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1166" name="ln-1166" href="#ln-1166"></a><span class="w">                     </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">t</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1167" name="ln-1167" href="#ln-1167"></a><span class="w">                </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading directly from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1168" name="ln-1168" href="#ln-1168"></a><span class="w">             </span><span class="k">END DO</span>
<a id="ln-1169" name="ln-1169" href="#ln-1169"></a>
<a id="ln-1170" name="ln-1170" href="#ln-1170"></a><span class="k">          ELSE</span>
<a id="ln-1171" name="ln-1171" href="#ln-1171"></a>
<a id="ln-1172" name="ln-1172" href="#ln-1172"></a><span class="k">             </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_GET_VAR</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">V_ID</span><span class="p">(</span><span class="n">iVar</span><span class="p">),</span><span class="w"> </span><span class="n">tmparr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1173" name="ln-1173" href="#ln-1173"></a><span class="w">                  </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="o">/</span><span class="p">),</span><span class="nb">count</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">xds</span><span class="p">,</span><span class="n">yds</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1174" name="ln-1174" href="#ln-1174"></a><span class="w">             </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reading from &quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">iVar</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1175" name="ln-1175" href="#ln-1175"></a><span class="w">             </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1176" name="ln-1176" href="#ln-1176"></a><span class="w">                </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmparr</span><span class="p">(</span><span class="w"> </span><span class="n">land_x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">land_y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1177" name="ln-1177" href="#ln-1177"></a><span class="w">             </span><span class="k">END DO</span>
<a id="ln-1178" name="ln-1178" href="#ln-1178"></a><span class="k">          ENDIF</span>
<a id="ln-1179" name="ln-1179" href="#ln-1179"></a>
<a id="ln-1180" name="ln-1180" href="#ln-1180"></a><span class="k">       END SELECT</span>
<a id="ln-1181" name="ln-1181" href="#ln-1181"></a>
<a id="ln-1182" name="ln-1182" href="#ln-1182"></a><span class="k">    END DO</span><span class="w">  </span><span class="c">! End of loop through all met variables</span>
<a id="ln-1183" name="ln-1183" href="#ln-1183"></a>
<a id="ln-1184" name="ln-1184" href="#ln-1184"></a><span class="w">    </span><span class="c">! Convert pressure Pa -&gt; hPa</span>
<a id="ln-1185" name="ln-1185" href="#ln-1185"></a>
<a id="ln-1186" name="ln-1186" href="#ln-1186"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">pres</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">pres</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(:)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="mf">0.</span><span class="w"></span>
<a id="ln-1187" name="ln-1187" href="#ln-1187"></a>
<a id="ln-1188" name="ln-1188" href="#ln-1188"></a><span class="w">    </span><span class="c">!print *, &#39;CRU%CTSTEP &#39;, CRU%CTSTEP</span>
<a id="ln-1189" name="ln-1189" href="#ln-1189"></a>
<a id="ln-1190" name="ln-1190" href="#ln-1190"></a><span class="w">    </span><span class="c">! Increment the internal timestep counter</span>
<a id="ln-1191" name="ln-1191" href="#ln-1191"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">CTSTEP</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1192" name="ln-1192" href="#ln-1192"></a>
<a id="ln-1193" name="ln-1193" href="#ln-1193"></a><span class="w">    </span><span class="c">! CALL1 can only happen once!</span>
<a id="ln-1194" name="ln-1194" href="#ln-1194"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">CALL1</span><span class="p">)</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-1195" name="ln-1195" href="#ln-1195"></a>
<a id="ln-1196" name="ln-1196" href="#ln-1196"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(tmin)%METVALS(:)&#39;</span>
<a id="ln-1197" name="ln-1197" href="#ln-1197"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(tmin)%METVALS(:)</span>
<a id="ln-1198" name="ln-1198" href="#ln-1198"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(nexttmin)%METVALS(:)&#39;</span>
<a id="ln-1199" name="ln-1199" href="#ln-1199"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(nexttmin)%METVALS(:)</span>
<a id="ln-1200" name="ln-1200" href="#ln-1200"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(prevtmax)%METVALS(:)&#39;</span>
<a id="ln-1201" name="ln-1201" href="#ln-1201"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(prevtmax)%METVALS(:)</span>
<a id="ln-1202" name="ln-1202" href="#ln-1202"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(tmax)%METVALS(:)&#39;</span>
<a id="ln-1203" name="ln-1203" href="#ln-1203"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(tmax)%METVALS(:)</span>
<a id="ln-1204" name="ln-1204" href="#ln-1204"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(pres)%METVALS(:)&#39;</span>
<a id="ln-1205" name="ln-1205" href="#ln-1205"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(pres)%METVALS(:)</span>
<a id="ln-1206" name="ln-1206" href="#ln-1206"></a><span class="w">    </span><span class="c">!  print *, &#39;CRU%MET(rain)%METVALS(:)&#39;</span>
<a id="ln-1207" name="ln-1207" href="#ln-1207"></a><span class="w">    </span><span class="c">!  print *, CRU%MET(rain)%METVALS(:)</span>
<a id="ln-1208" name="ln-1208" href="#ln-1208"></a>
<a id="ln-1209" name="ln-1209" href="#ln-1209"></a><span class="w">  </span><span class="k">END SUBROUTINE </span><span class="n">CRU_GET_DAILY_MET</span><span class="w"></span>
<a id="ln-1210" name="ln-1210" href="#ln-1210"></a>
<a id="ln-1211" name="ln-1211" href="#ln-1211"></a><span class="w">  </span><span class="c">!**************************************************************************************************</span>
<a id="ln-1212" name="ln-1212" href="#ln-1212"></a>
<a id="ln-1213" name="ln-1213" href="#ln-1213"></a><span class="w">  </span><span class="k">SUBROUTINE </span><span class="n">CRU_GET_SUBDIURNAL_MET</span><span class="p">(</span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">MET</span><span class="p">,</span><span class="w"> </span><span class="n">CurYear</span><span class="p">,</span><span class="w"> </span><span class="n">ktau</span><span class="p">,</span><span class="w"> </span><span class="n">kend</span><span class="p">,</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1214" name="ln-1214" href="#ln-1214"></a>
<a id="ln-1215" name="ln-1215" href="#ln-1215"></a><span class="w">    </span><span class="c">! Obtain one day of CRU-NCEP meteorology, subdiurnalise it using a weather</span>
<a id="ln-1216" name="ln-1216" href="#ln-1216"></a><span class="w">    </span><span class="c">! and return the result to the CABLE driver.</span>
<a id="ln-1217" name="ln-1217" href="#ln-1217"></a>
<a id="ln-1218" name="ln-1218" href="#ln-1218"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_def_types_mod</span><span class="p">,</span><span class="w">   </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">MET_TYPE</span><span class="w"></span>
<a id="ln-1219" name="ln-1219" href="#ln-1219"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_IO_vars_module</span><span class="p">,</span><span class="w">  </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">LANDPT</span><span class="p">,</span><span class="w"> </span><span class="n">latitude</span><span class="w"></span>
<a id="ln-1220" name="ln-1220" href="#ln-1220"></a><span class="w">  </span><span class="k">USE </span><span class="n">casa_ncdf_module</span><span class="p">,</span><span class="w"> </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">DOYSOD2YMDHMS</span><span class="w"></span>
<a id="ln-1221" name="ln-1221" href="#ln-1221"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_weathergenerator</span><span class="p">,</span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">WEATHER_GENERATOR_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">WGEN_INIT</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1222" name="ln-1222" href="#ln-1222"></a><span class="w">         </span><span class="n">WGEN_DAILY_CONSTANTS</span><span class="p">,</span><span class="w"> </span><span class="n">WGEN_SUBDIURNAL_MET</span><span class="w"></span>
<a id="ln-1223" name="ln-1223" href="#ln-1223"></a><span class="w">    </span><span class="k">USE </span><span class="n">cable_checks_module</span><span class="p">,</span><span class="w">   </span><span class="k">ONLY</span><span class="p">:</span><span class="w"> </span><span class="n">rh_sh</span><span class="w"></span>
<a id="ln-1224" name="ln-1224" href="#ln-1224"></a>
<a id="ln-1225" name="ln-1225" href="#ln-1225"></a><span class="w">    </span><span class="k">IMPLICIT NONE</span>
<a id="ln-1226" name="ln-1226" href="#ln-1226"></a>
<a id="ln-1227" name="ln-1227" href="#ln-1227"></a><span class="k">    </span><span class="kt">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">CurYear</span><span class="p">,</span><span class="w"> </span><span class="n">ktau</span><span class="p">,</span><span class="w"> </span><span class="n">kend</span><span class="w"></span>
<a id="ln-1228" name="ln-1228" href="#ln-1228"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w"> </span><span class="k">INTENT</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"></span>
<a id="ln-1229" name="ln-1229" href="#ln-1229"></a>
<a id="ln-1230" name="ln-1230" href="#ln-1230"></a><span class="w">    </span><span class="k">TYPE</span><span class="p">(</span><span class="n">CRU_TYPE</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CRU</span><span class="w"></span>
<a id="ln-1231" name="ln-1231" href="#ln-1231"></a>
<a id="ln-1232" name="ln-1232" href="#ln-1232"></a><span class="w">    </span><span class="c">! Define MET the CABLE version, different from the MET defined and used within the CRU variable.</span>
<a id="ln-1233" name="ln-1233" href="#ln-1233"></a><span class="w">    </span><span class="c">! The structure of MET_TYPE is defined in cable_define_types.F90</span>
<a id="ln-1234" name="ln-1234" href="#ln-1234"></a><span class="w">    </span><span class="k">TYPE</span><span class="p">(</span><span class="n">MET_TYPE</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">MET</span><span class="w"></span>
<a id="ln-1235" name="ln-1235" href="#ln-1235"></a>
<a id="ln-1236" name="ln-1236" href="#ln-1236"></a><span class="w">    </span><span class="c">! Local variables</span>
<a id="ln-1237" name="ln-1237" href="#ln-1237"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">newday</span><span class="p">,</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="w">  </span><span class="c">! Flags for occurence of a new day (0 hrs) and the last day of the year.</span>
<a id="ln-1238" name="ln-1238" href="#ln-1238"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">iland</span><span class="w">                  </span><span class="c">! Loop counter through &#39;land&#39; cells (cells in the spatial domain)</span>
<a id="ln-1239" name="ln-1239" href="#ln-1239"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">itimestep</span><span class="w">              </span><span class="c">! Loop counter through subdiurnal timesteps in a day</span>
<a id="ln-1240" name="ln-1240" href="#ln-1240"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">imetvar</span><span class="w">                </span><span class="c">! Loop counter through met variables</span>
<a id="ln-1241" name="ln-1241" href="#ln-1241"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">dM</span><span class="p">,</span><span class="w"> </span><span class="n">dD</span><span class="w">                 </span><span class="c">! Met date as year, month, and day returned from DOYSOD2YMDHMS</span>
<a id="ln-1242" name="ln-1242" href="#ln-1242"></a><span class="w">    </span><span class="kt">INTEGER</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="k">is</span><span class="p">,</span><span class="w"> </span><span class="n">ie</span><span class="w">                 </span><span class="c">! Starting and ending vegetation type per land cell</span>
<a id="ln-1243" name="ln-1243" href="#ln-1243"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">dt</span><span class="w">                     </span><span class="c">! Timestep in seconds</span>
<a id="ln-1244" name="ln-1244" href="#ln-1244"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">CO2air</span><span class="w">                 </span><span class="c">! CO2 concentration in ppm</span>
<a id="ln-1245" name="ln-1245" href="#ln-1245"></a><span class="w">    </span><span class="kt">REAL</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="nb">etime</span>
<a id="ln-1246" name="ln-1246" href="#ln-1246"></a><span class="nb">    </span><span class="kt">CHARACTER</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LandMaskFile</span><span class="o">*</span><span class="mi">200</span><span class="w">       </span><span class="c">! Name of the land mask file</span>
<a id="ln-1247" name="ln-1247" href="#ln-1247"></a>
<a id="ln-1248" name="ln-1248" href="#ln-1248"></a><span class="w">    </span><span class="k">TYPE</span><span class="p">(</span><span class="n">WEATHER_GENERATOR_TYPE</span><span class="p">),</span><span class="w"> </span><span class="k">SAVE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">WG</span><span class="w"></span>
<a id="ln-1249" name="ln-1249" href="#ln-1249"></a><span class="w">    </span><span class="kt">LOGICAL</span><span class="p">,</span><span class="w">                      </span><span class="k">SAVE</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w">  </span><span class="c">! A *local* variable recording the first call of this routine</span>
<a id="ln-1250" name="ln-1250" href="#ln-1250"></a>
<a id="ln-1251" name="ln-1251" href="#ln-1251"></a><span class="w">    </span><span class="c">! Purely for readability...</span>
<a id="ln-1252" name="ln-1252" href="#ln-1252"></a><span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">DTsecs</span><span class="w"></span>
<a id="ln-1253" name="ln-1253" href="#ln-1253"></a>
<a id="ln-1254" name="ln-1254" href="#ln-1254"></a><span class="w">    </span><span class="c">! On first step read and check CRU settings and read land-mask</span>
<a id="ln-1255" name="ln-1255" href="#ln-1255"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">CALL1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">WGEN_INIT</span><span class="p">(</span><span class="w"> </span><span class="n">WG</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">,</span><span class="w"> </span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1256" name="ln-1256" href="#ln-1256"></a>
<a id="ln-1257" name="ln-1257" href="#ln-1257"></a><span class="w">    </span><span class="c">! Pass time-step information to CRU</span>
<a id="ln-1258" name="ln-1258" href="#ln-1258"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">CYEAR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CurYear</span><span class="w"></span>
<a id="ln-1259" name="ln-1259" href="#ln-1259"></a>
<a id="ln-1260" name="ln-1260" href="#ln-1260"></a>
<a id="ln-1261" name="ln-1261" href="#ln-1261"></a><span class="w">    </span><span class="n">CRU</span><span class="p">%</span><span class="n">ktau</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ktau</span><span class="w">     </span><span class="c">! ktau is the current timestep in the year.</span>
<a id="ln-1262" name="ln-1262" href="#ln-1262"></a>
<a id="ln-1263" name="ln-1263" href="#ln-1263"></a><span class="c">!!!!  this only works with CANBERRA cable_driver, as ktau    !!!!</span>
<a id="ln-1264" name="ln-1264" href="#ln-1264"></a><span class="c">!!!!  restarts on Jan 1                                      !!!!</span>
<a id="ln-1265" name="ln-1265" href="#ln-1265"></a><span class="w">    </span><span class="c">! Based on the ktau timestep, calculate date and time information (the same for the whole spatial dimension.)</span>
<a id="ln-1266" name="ln-1266" href="#ln-1266"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">hod</span><span class="w"> </span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">REAL</span><span class="p">(</span><span class="nb">MOD</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">ktau</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">SecDay</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">360</span><span class="mf">0.</span><span class="w">  </span><span class="c">! Hour of the day</span>
<a id="ln-1267" name="ln-1267" href="#ln-1267"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">doy</span><span class="w"> </span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">ktau</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">SecDay</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                   </span><span class="c">! Day of Year = days since 0 hr 1st Jan</span>
<a id="ln-1268" name="ln-1268" href="#ln-1268"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">year</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CurYear</span><span class="w">                                                </span><span class="c">! Current year</span>
<a id="ln-1269" name="ln-1269" href="#ln-1269"></a>
<a id="ln-1270" name="ln-1270" href="#ln-1270"></a><span class="w">    </span><span class="c">! Using the day-of-year and seconds-of-day calculate the month and day-of-month, using the time information</span>
<a id="ln-1271" name="ln-1271" href="#ln-1271"></a><span class="w">    </span><span class="c">! for the first land cell only (because they will be the same across the domain).</span>
<a id="ln-1272" name="ln-1272" href="#ln-1272"></a><span class="w">    </span><span class="c">!                            In      In         In        Out       Out       Optional Out</span>
<a id="ln-1273" name="ln-1273" href="#ln-1273"></a><span class="w">    </span><span class="c">! SUBROUTINE DOYSOD2YMDHMS( Year, Yearday, SecondsOfDay, Month, DayOfMonth, [Hour, Min, Sec])</span>
<a id="ln-1274" name="ln-1274" href="#ln-1274"></a>
<a id="ln-1275" name="ln-1275" href="#ln-1275"></a><span class="w">    </span><span class="k">CALL </span><span class="n">DOYSOD2YMDHMS</span><span class="p">(</span><span class="n">CurYear</span><span class="p">,</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">met</span><span class="p">%</span><span class="n">doy</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">met</span><span class="p">%</span><span class="n">hod</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w"> </span><span class="n">dM</span><span class="p">,</span><span class="w"> </span><span class="n">dD</span><span class="p">)</span><span class="w"></span>
<a id="ln-1276" name="ln-1276" href="#ln-1276"></a>
<a id="ln-1277" name="ln-1277" href="#ln-1277"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">moy</span><span class="w"> </span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dM</span><span class="w">     </span><span class="c">! Record the month</span>
<a id="ln-1278" name="ln-1278" href="#ln-1278"></a>
<a id="ln-1279" name="ln-1279" href="#ln-1279"></a><span class="w">    </span><span class="c">! It&#39;s a new day if the hour of the day is zero.</span>
<a id="ln-1280" name="ln-1280" href="#ln-1280"></a><span class="w">    </span><span class="n">newday</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">met</span><span class="p">%</span><span class="n">hod</span><span class="p">(</span><span class="n">landpt</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">cstart</span><span class="p">).</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1281" name="ln-1281" href="#ln-1281"></a>
<a id="ln-1282" name="ln-1282" href="#ln-1282"></a><span class="w">    </span><span class="c">! Beginning-of-year accounting</span>
<a id="ln-1283" name="ln-1283" href="#ln-1283"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">ktau</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">  </span><span class="c">! ktau is always reset to 1 at the start of the year.</span>
<a id="ln-1284" name="ln-1284" href="#ln-1284"></a>
<a id="ln-1285" name="ln-1285" href="#ln-1285"></a><span class="w">       </span><span class="c">! Read a new annual CO2 value and convert it from ppm to mol/mol</span>
<a id="ln-1286" name="ln-1286" href="#ln-1286"></a><span class="w">       </span><span class="k">CALL </span><span class="n">GET_CRU_CO2</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">CO2air</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1287" name="ln-1287" href="#ln-1287"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">ca</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CO2air</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.e+6</span><span class="w">  </span><span class="c">!</span>
<a id="ln-1288" name="ln-1288" href="#ln-1288"></a>
<a id="ln-1289" name="ln-1289" href="#ln-1289"></a><span class="w">       </span><span class="k">CALL </span><span class="n">GET_CRU_Ndep</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1290" name="ln-1290" href="#ln-1290"></a><span class="w">       </span><span class="k">DO </span><span class="n">iland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1291" name="ln-1291" href="#ln-1291"></a><span class="w">          </span><span class="n">met</span><span class="p">%</span><span class="n">Ndep</span><span class="p">(</span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cstart</span><span class="p">:</span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cend</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1292" name="ln-1292" href="#ln-1292"></a><span class="w">               </span><span class="n">CRU</span><span class="p">%</span><span class="n">NdepVALS</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="o">*</span><span class="mi">8640000</span><span class="mf">0.</span><span class="w">  </span><span class="c">! kg/m2/s &gt; g/m2/d (1000.*3600.*24.)</span>
<a id="ln-1293" name="ln-1293" href="#ln-1293"></a><span class="w">       </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-1294" name="ln-1294" href="#ln-1294"></a>
<a id="ln-1295" name="ln-1295" href="#ln-1295"></a><span class="w">       </span><span class="c">! Open a new annual CRU-NCEP met file.</span>
<a id="ln-1296" name="ln-1296" href="#ln-1296"></a><span class="w">       </span><span class="k">CALL </span><span class="n">OPEN_CRU_MET</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1297" name="ln-1297" href="#ln-1297"></a>
<a id="ln-1298" name="ln-1298" href="#ln-1298"></a><span class="w">    </span><span class="k">ENDIF</span><span class="w"></span>
<a id="ln-1299" name="ln-1299" href="#ln-1299"></a>
<a id="ln-1300" name="ln-1300" href="#ln-1300"></a><span class="w">    </span><span class="c">! %%%%%% PRB to add his own comments from here down for this routine.</span>
<a id="ln-1301" name="ln-1301" href="#ln-1301"></a><span class="w">    </span><span class="c">! Now get the Met data for this day</span>
<a id="ln-1302" name="ln-1302" href="#ln-1302"></a>
<a id="ln-1303" name="ln-1303" href="#ln-1303"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">newday</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<a id="ln-1304" name="ln-1304" href="#ln-1304"></a>
<a id="ln-1305" name="ln-1305" href="#ln-1305"></a><span class="w">       </span><span class="c">!print *, CRU%CTSTEP, ktau, kend</span>
<a id="ln-1306" name="ln-1306" href="#ln-1306"></a><span class="w">       </span><span class="c">!   CALL CPU_TIME(etime)</span>
<a id="ln-1307" name="ln-1307" href="#ln-1307"></a><span class="w">       </span><span class="c">!   PRINT *, &#39;b4 daily &#39;, etime, &#39; seconds needed &#39;</span>
<a id="ln-1308" name="ln-1308" href="#ln-1308"></a>
<a id="ln-1309" name="ln-1309" href="#ln-1309"></a><span class="w">       </span><span class="n">LastDayOfYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ktau</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="n">kend</span><span class="o">-</span><span class="p">((</span><span class="n">SecDay</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<a id="ln-1310" name="ln-1310" href="#ln-1310"></a><span class="w">       </span><span class="k">CALL </span><span class="n">CRU_GET_DAILY_MET</span><span class="p">(</span><span class="w"> </span><span class="n">CRU</span><span class="p">,</span><span class="w"> </span><span class="n">LastDayOfYear</span><span class="p">,</span><span class="w"> </span><span class="n">LastYearOfMet</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1311" name="ln-1311" href="#ln-1311"></a><span class="w">       </span><span class="c">!   CALL CPU_TIME(etime)</span>
<a id="ln-1312" name="ln-1312" href="#ln-1312"></a><span class="w">       </span><span class="c">!   PRINT *, &#39;after daily &#39;, etime, &#39; seconds needed &#39;</span>
<a id="ln-1313" name="ln-1313" href="#ln-1313"></a><span class="w">       </span><span class="c">!   STOP</span>
<a id="ln-1314" name="ln-1314" href="#ln-1314"></a>
<a id="ln-1315" name="ln-1315" href="#ln-1315"></a><span class="w">       </span><span class="c">! Air pressure assumed to be constant over day</span>
<a id="ln-1316" name="ln-1316" href="#ln-1316"></a><span class="w">       </span><span class="k">DO </span><span class="n">iland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1317" name="ln-1317" href="#ln-1317"></a><span class="w">          </span><span class="n">met</span><span class="p">%</span><span class="n">pmb</span><span class="p">(</span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cstart</span><span class="p">:</span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cend</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">pres</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="c">!CLN interpolation??</span>
<a id="ln-1318" name="ln-1318" href="#ln-1318"></a><span class="w">       </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-1319" name="ln-1319" href="#ln-1319"></a>
<a id="ln-1320" name="ln-1320" href="#ln-1320"></a><span class="w">       </span><span class="c">! Convert wind from u and v components to wind speed by Pythagorean Theorem</span>
<a id="ln-1321" name="ln-1321" href="#ln-1321"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">WindDay</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">uwind</span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">uwind</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1322" name="ln-1322" href="#ln-1322"></a><span class="w">            </span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">vwind</span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">vwind</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1323" name="ln-1323" href="#ln-1323"></a><span class="w">       </span><span class="c">! Convert all temperatures from K to C</span>
<a id="ln-1324" name="ln-1324" href="#ln-1324"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">TempMinDay</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">Tmin</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span><span class="w"></span>
<a id="ln-1325" name="ln-1325" href="#ln-1325"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">TempMaxDay</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">Tmax</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span><span class="w"></span>
<a id="ln-1326" name="ln-1326" href="#ln-1326"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">TempMinDayNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">NextTmin</span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span><span class="w"></span>
<a id="ln-1327" name="ln-1327" href="#ln-1327"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">TempMaxDayPrev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">PrevTmax</span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span><span class="w"></span>
<a id="ln-1328" name="ln-1328" href="#ln-1328"></a><span class="w">       </span><span class="c">! Convert solar radiation from J /m2/s to MJ/m2/d</span>
<a id="ln-1329" name="ln-1329" href="#ln-1329"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">SolarMJDay</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">swdn</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.e-6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SecDay</span><span class="w"> </span><span class="c">! -&gt;[MJ/m2/d]</span>
<a id="ln-1330" name="ln-1330" href="#ln-1330"></a><span class="w">       </span><span class="c">! Convert precip from mm to m/day</span>
<a id="ln-1331" name="ln-1331" href="#ln-1331"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">PrecipDay</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="w">  </span><span class="n">rain</span><span class="w">  </span><span class="p">)%</span><span class="n">METVALS</span><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="mf">0.</span><span class="w"> </span><span class="c">! -&gt;[m/d]</span>
<a id="ln-1332" name="ln-1332" href="#ln-1332"></a><span class="w">       </span><span class="n">WG</span><span class="p">%</span><span class="n">SnowDay</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-1333" name="ln-1333" href="#ln-1333"></a>
<a id="ln-1334" name="ln-1334" href="#ln-1334"></a><span class="w">       </span><span class="k">CALL </span><span class="n">WGEN_DAILY_CONSTANTS</span><span class="p">(</span><span class="w"> </span><span class="n">WG</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">,</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">met</span><span class="p">%</span><span class="n">doy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1335" name="ln-1335" href="#ln-1335"></a>
<a id="ln-1336" name="ln-1336" href="#ln-1336"></a><span class="w">       </span><span class="c">! To get the diurnal cycle for lwdn get whole day and scale with</span>
<a id="ln-1337" name="ln-1337" href="#ln-1337"></a><span class="w">       </span><span class="c">! LWDN from file later</span>
<a id="ln-1338" name="ln-1338" href="#ln-1338"></a>
<a id="ln-1339" name="ln-1339" href="#ln-1339"></a><span class="w">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="w"></span>
<a id="ln-1340" name="ln-1340" href="#ln-1340"></a><span class="w">       </span><span class="k">DO </span><span class="n">itimestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">SecDay</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<a id="ln-1341" name="ln-1341" href="#ln-1341"></a><span class="w">          </span><span class="k">CALL </span><span class="n">WGEN_SUBDIURNAL_MET</span><span class="p">(</span><span class="w"> </span><span class="n">WG</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">,</span><span class="w"> </span><span class="n">itimestep</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1342" name="ln-1342" href="#ln-1342"></a><span class="w">          </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">PhiLD</span><span class="w"></span>
<a id="ln-1343" name="ln-1343" href="#ln-1343"></a><span class="w">       </span><span class="k">END DO</span>
<a id="ln-1344" name="ln-1344" href="#ln-1344"></a><span class="k">       </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">SecDay</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<a id="ln-1345" name="ln-1345" href="#ln-1345"></a><span class="w">    </span><span class="k">END IF</span><span class="w"> </span><span class="c">! End of If newday</span>
<a id="ln-1346" name="ln-1346" href="#ln-1346"></a>
<a id="ln-1347" name="ln-1347" href="#ln-1347"></a><span class="w">    </span><span class="c">! Decision has been made, that first tstep of the day is at 0:01 am</span>
<a id="ln-1348" name="ln-1348" href="#ln-1348"></a>
<a id="ln-1349" name="ln-1349" href="#ln-1349"></a><span class="w">    </span><span class="k">CALL </span><span class="n">WGEN_SUBDIURNAL_MET</span><span class="p">(</span><span class="w"> </span><span class="n">WG</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="p">,</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">met</span><span class="p">%</span><span class="n">hod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">360</span><span class="mf">0.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<a id="ln-1350" name="ln-1350" href="#ln-1350"></a>
<a id="ln-1351" name="ln-1351" href="#ln-1351"></a><span class="w">    </span><span class="c">! assign to cable variables</span>
<a id="ln-1352" name="ln-1352" href="#ln-1352"></a>
<a id="ln-1353" name="ln-1353" href="#ln-1353"></a><span class="w">    </span><span class="c">! strangely, met% is not save over Wait all in MPI...!</span>
<a id="ln-1354" name="ln-1354" href="#ln-1354"></a><span class="w">    </span><span class="c">!  met%pmb = CRU%MET(pres)%METVALS !CLN interpolation??</span>
<a id="ln-1355" name="ln-1355" href="#ln-1355"></a>
<a id="ln-1356" name="ln-1356" href="#ln-1356"></a><span class="w">    </span><span class="c">! Assign weather-generated data, or daily values, as required to CABLE variables.</span>
<a id="ln-1357" name="ln-1357" href="#ln-1357"></a><span class="w">    </span><span class="c">!</span>
<a id="ln-1358" name="ln-1358" href="#ln-1358"></a><span class="w">    </span><span class="k">DO </span><span class="n">iland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">mland</span><span class="w"></span>
<a id="ln-1359" name="ln-1359" href="#ln-1359"></a><span class="w">       </span><span class="k">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cstart</span><span class="w"></span>
<a id="ln-1360" name="ln-1360" href="#ln-1360"></a><span class="w">       </span><span class="n">ie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">landpt</span><span class="p">(</span><span class="n">iland</span><span class="p">)%</span><span class="n">cend</span><span class="w"></span>
<a id="ln-1361" name="ln-1361" href="#ln-1361"></a>
<a id="ln-1362" name="ln-1362" href="#ln-1362"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">precip</span><span class="w">    </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">Precip</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"></span>
<a id="ln-1363" name="ln-1363" href="#ln-1363"></a>
<a id="ln-1364" name="ln-1364" href="#ln-1364"></a>
<a id="ln-1365" name="ln-1365" href="#ln-1365"></a><span class="w">       </span><span class="c">! Cable&#39;s swdown is split into two components, visible and nir, which</span>
<a id="ln-1366" name="ln-1366" href="#ln-1366"></a><span class="w">       </span><span class="c">! get half of the CRU-NCEP swdown each.</span>
<a id="ln-1367" name="ln-1367" href="#ln-1367"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">fsd</span><span class="w">       </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">PhiSD</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w">    </span><span class="c">! Visible</span>
<a id="ln-1368" name="ln-1368" href="#ln-1368"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">fsd</span><span class="w">       </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">PhiSD</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w">  </span><span class="c">! NIR</span>
<a id="ln-1369" name="ln-1369" href="#ln-1369"></a>
<a id="ln-1370" name="ln-1370" href="#ln-1370"></a><span class="w">       </span><span class="c">! Convert C to K for cable&#39;s tk</span>
<a id="ln-1371" name="ln-1371" href="#ln-1371"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">tk</span><span class="w">        </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">Temp</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">27</span><span class="mf">3.15</span><span class="w"></span>
<a id="ln-1372" name="ln-1372" href="#ln-1372"></a>
<a id="ln-1373" name="ln-1373" href="#ln-1373"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">ua</span><span class="w">        </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">Wind</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"></span>
<a id="ln-1374" name="ln-1374" href="#ln-1374"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">coszen</span><span class="w">    </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">coszen</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"></span>
<a id="ln-1375" name="ln-1375" href="#ln-1375"></a>
<a id="ln-1376" name="ln-1376" href="#ln-1376"></a><span class="w">       </span><span class="c">! For longwave down, scale the diurnal series returned by the weather generator (WG%PhiLD(iland))</span>
<a id="ln-1377" name="ln-1377" href="#ln-1377"></a><span class="w">       </span><span class="c">! to the daily value from CRU-NCEP.</span>
<a id="ln-1378" name="ln-1378" href="#ln-1378"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">fld</span><span class="w">       </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">lwdn</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">WG</span><span class="p">%</span><span class="n">PhiLD</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">AVG_LWDN</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"></span>
<a id="ln-1379" name="ln-1379" href="#ln-1379"></a>
<a id="ln-1380" name="ln-1380" href="#ln-1380"></a><span class="w">       </span><span class="c">! Specific humidity (qair g/g) was not sent to the weather generator. Here we assign the</span>
<a id="ln-1381" name="ln-1381" href="#ln-1381"></a><span class="w">       </span><span class="c">! daily value to the whole diurnal cycle</span>
<a id="ln-1382" name="ln-1382" href="#ln-1382"></a><span class="w">       </span><span class="n">met</span><span class="p">%</span><span class="n">qv</span><span class="w">        </span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">MET</span><span class="p">(</span><span class="n">qair</span><span class="p">)%</span><span class="n">METVALS</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"></span>
<a id="ln-1383" name="ln-1383" href="#ln-1383"></a>
<a id="ln-1384" name="ln-1384" href="#ln-1384"></a><span class="w">       </span><span class="c">! calculate snowfall based on total precip and air T</span>
<a id="ln-1385" name="ln-1385" href="#ln-1385"></a><span class="w">       </span><span class="c">!(ref Jin et al. Table II, Hyd Proc, 1999)</span>
<a id="ln-1386" name="ln-1386" href="#ln-1386"></a>
<a id="ln-1387" name="ln-1387" href="#ln-1387"></a><span class="c">!!$    if (WG%Temp(iland) &gt; 2.5) then</span>
<a id="ln-1388" name="ln-1388" href="#ln-1388"></a><span class="c">!!$       met%precip_sn(is:ie) = 0.0</span>
<a id="ln-1389" name="ln-1389" href="#ln-1389"></a><span class="c">!!$    elseif ((WG%Temp(iland) &lt;= 2.5) .and. (WG%Temp(iland) &gt; 2.0)) then</span>
<a id="ln-1390" name="ln-1390" href="#ln-1390"></a><span class="c">!!$       met%precip_sn(is:ie) = 0.6* met%precip(is:ie)</span>
<a id="ln-1391" name="ln-1391" href="#ln-1391"></a><span class="c">!!$    elseif ((WG%Temp(iland) &lt;= 2.0) .and. (WG%Temp(iland) &gt; 0.0)) then</span>
<a id="ln-1392" name="ln-1392" href="#ln-1392"></a><span class="c">!!$       met%precip_sn(is:ie) = (1.0 - (54.62 - 0.2 *(WG%Temp(iland) + 273.15)))* met%precip(is:ie) ! this facr can be &gt; 1 !!!</span>
<a id="ln-1393" name="ln-1393" href="#ln-1393"></a><span class="c">!!$    elseif (WG%Temp(iland) &lt;= 0.0) then</span>
<a id="ln-1394" name="ln-1394" href="#ln-1394"></a><span class="c">!!$       met%precip_sn(is:ie) = met%precip(is:ie)</span>
<a id="ln-1395" name="ln-1395" href="#ln-1395"></a><span class="c">!!$    endif</span>
<a id="ln-1396" name="ln-1396" href="#ln-1396"></a>
<a id="ln-1397" name="ln-1397" href="#ln-1397"></a><span class="w">       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">WG</span><span class="p">%</span><span class="n">Temp</span><span class="p">(</span><span class="n">iland</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1398" name="ln-1398" href="#ln-1398"></a><span class="k">          </span><span class="n">met</span><span class="p">%</span><span class="n">precip_sn</span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">met</span><span class="p">%</span><span class="n">precip</span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w"></span>
<a id="ln-1399" name="ln-1399" href="#ln-1399"></a><span class="w">       </span><span class="k">ELSE</span>
<a id="ln-1400" name="ln-1400" href="#ln-1400"></a><span class="k">          </span><span class="n">met</span><span class="p">%</span><span class="n">precip_sn</span><span class="p">(</span><span class="k">is</span><span class="p">:</span><span class="n">ie</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<a id="ln-1401" name="ln-1401" href="#ln-1401"></a><span class="w">       </span><span class="k">ENDIF</span><span class="w"></span>
<a id="ln-1402" name="ln-1402" href="#ln-1402"></a><span class="w">       </span><span class="c">!met%precip(is:ie) = met%precip(is:ie) -  met%precip_sn(is:ie)</span>
<a id="ln-1403" name="ln-1403" href="#ln-1403"></a>
<a id="ln-1404" name="ln-1404" href="#ln-1404"></a>
<a id="ln-1405" name="ln-1405" href="#ln-1405"></a>
<a id="ln-1406" name="ln-1406" href="#ln-1406"></a><span class="w">    </span><span class="k">END DO</span><span class="w"></span>
<a id="ln-1407" name="ln-1407" href="#ln-1407"></a>
<a id="ln-1408" name="ln-1408" href="#ln-1408"></a><span class="w">    </span><span class="c">! initialise within canopy air temp</span>
<a id="ln-1409" name="ln-1409" href="#ln-1409"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">tvair</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">met</span><span class="p">%</span><span class="n">tk</span><span class="w"></span>
<a id="ln-1410" name="ln-1410" href="#ln-1410"></a><span class="w">    </span><span class="n">met</span><span class="p">%</span><span class="n">tvrad</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">met</span><span class="p">%</span><span class="n">tk</span><span class="w"></span>
<a id="ln-1411" name="ln-1411" href="#ln-1411"></a>
<a id="ln-1412" name="ln-1412" href="#ln-1412"></a><span class="w">    </span><span class="c">! If this is the end of the year or the end of the met, close the current met files.</span>
<a id="ln-1413" name="ln-1413" href="#ln-1413"></a><span class="w">    </span><span class="c">!print *, &quot;ktau, kend, LastYearOfMet as close test:&quot;, ktau, kend</span>
<a id="ln-1414" name="ln-1414" href="#ln-1414"></a><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">ktau</span><span class="w"> </span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="w"> </span><span class="n">kend</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<a id="ln-1415" name="ln-1415" href="#ln-1415"></a><span class="k">       DO </span><span class="n">imetvar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">CRU</span><span class="p">%</span><span class="n">NMET</span><span class="w"></span>
<a id="ln-1416" name="ln-1416" href="#ln-1416"></a><span class="w">          </span><span class="c">!print *, &#39;Close CRU%MetFile(imetvar)&#39;, CRU%MetFile(imetvar)</span>
<a id="ln-1417" name="ln-1417" href="#ln-1417"></a><span class="w">          </span><span class="n">ErrStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NF90_CLOSE</span><span class="p">(</span><span class="n">CRU</span><span class="p">%</span><span class="n">F_ID</span><span class="p">(</span><span class="n">imetvar</span><span class="p">))</span><span class="w"></span>
<a id="ln-1418" name="ln-1418" href="#ln-1418"></a><span class="w">          </span><span class="k">CALL </span><span class="n">HANDLE_ERR</span><span class="p">(</span><span class="n">ErrStatus</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Closing CRU file&quot;</span><span class="o">//</span><span class="n">CRU</span><span class="p">%</span><span class="n">MetFile</span><span class="p">(</span><span class="n">imetvar</span><span class="p">))</span><span class="w"></span>
<a id="ln-1419" name="ln-1419" href="#ln-1419"></a><span class="w">       </span><span class="k">END DO</span>
<a id="ln-1420" name="ln-1420" href="#ln-1420"></a><span class="k">    END IF</span><span class="w"></span>
<a id="ln-1421" name="ln-1421" href="#ln-1421"></a>
<a id="ln-1422" name="ln-1422" href="#ln-1422"></a><span class="w">    </span><span class="c">! CALL1 is over...</span>
<a id="ln-1423" name="ln-1423" href="#ln-1423"></a><span class="w">    </span><span class="n">CALL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<a id="ln-1424" name="ln-1424" href="#ln-1424"></a>
<a id="ln-1425" name="ln-1425" href="#ln-1425"></a><span class="w">  </span><span class="k">END SUBROUTINE </span><span class="n">CRU_GET_SUBDIURNAL_MET</span><span class="w"></span>
<a id="ln-1426" name="ln-1426" href="#ln-1426"></a>
<a id="ln-1427" name="ln-1427" href="#ln-1427"></a><span class="k">END MODULE </span><span class="n">CABLE_CRU</span><span class="w"></span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>CABLE was developed by CABLE community<br>&copy; 2022 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>