#==============================================================================
# This file is part of the
# Australian Community Atmosphere Biosphere Land Exchange (CABLE) model.
# This work is licensed under the CABLE Academic User Licence Agreement
# (the "Licence").
# You may not use this file except in compliance with the Licence.
# A copy of the Licence and registration form can be obtained from
# http://www.cawcr.gov.au/projects/access/cable
# You need to register and read the Licence agreement before use.
# Please contact cable_help@nf.nci.org.au for any questions on
# registration and the Licence.
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the Licence is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the Licence for the specific language governing permissions and
# limitations under the Licence.
# ==============================================================================
#
# Purpose: builds CABLE executable for offline case
#
# Contact: Bernard.Pak@csiro.au
#
# History: Additions for CASA-CNP

# Additions for SLI (Vanessa Haverd)
# Additions for SpinCASA (Lars Nieradzik)
# Additions for POP, climate and phenology (Vanessa Haverd)
# Additions for Land use change (Vanessa Haverd)
# ==============================================================================
##########################################################################

# these are all the files we are compiling
LSRC = cable_mpiworker.F90 \
cable_mpimaster.F90 \
cable_mpicommon.F90 \
cable_mpidrv.F90 \
pop_mpi.F90 \
cable_math_constants_mod.o cable_phys_constants_mod.o cable_other_constants_mod.o cable_photo_constants_mod.o \
cable_runtime_opts_mod.o cable_pft_params.o cable_soil_params.o \
casa_ncdf.o cbl_masks.o \
cbl_model_driver_offline.o   \
cbl_hgtAbove_snow.o cbl_lai_eff.o \
cable_iovars.o cable_abort.o \
cable_parameters.o cable_read.o cable_initialise.o cable_input.o \
cable_metutils.o \
cable_write.o cable_output.o cable_checks.o \
cable_define_types.o cable_common.o \
cbl_soilsnow_main.o cbl_soilsnow_subrs.o cbl_soilsnow_init_special.o \
cbl_albedo.o cbl_snow_albedo.o cbl_soilColour_albedo.o \
cbl_rhoch.o cbl_spitter.o cbl_sinbet.o cbl_radiation.o cbl_init_radiation.o \
cable_air.o \
cable_roughness.o \
cable_carbon.o \
cable_canopy.o \
cable_sli_main.o cable_sli_numbers.o cable_sli_roots.o cable_sli_solve.o cable_sli_utils.o \
POP.o pop_io.o \
cable_plume_mip.o cable_weathergenerator.o cable_climate.o \
cable_phenology.o \
cable_cru_TRENDY.o \
POPLUC.o cable_LUC_EXPT.o \
cable_gw_hydro.o cable_psm.o \
cable_namelist_input.o \
cable_site.o \
casa_variable.o \
CASAONLY_LUC.o \
casa_param.o \
casa_dimension.o \
casa_phenology.o \
casa_cnp.o \
casa_cable.o casa_inout.o \
landuse_constant.o \
landuse3.o landuse_inout.o

# this is the executable we are building
PROG = cable-mpi

# from the compiled object files
OBJS	= ${LSRC:.F90=.o}

#compiler switches and flags
CINC = -I$(NCMOD)

#suffixes we use
.SUFFIXES:
.SUFFIXES: .F90 .o
#default rules for these suffixes
.F90.o:
	$(FC) $(CFLAGS) $(CINC) -c $<

# default target by convention is ``all''
all : $(PROG)

#build PROG (cable executable) by linking all objects
$(PROG) : cable_mpidrv.o 
	$(FC) $(LDFLAGS) -o $@ $(OBJS) $(LD) 

pop_mpi.o: pop_mpi.F90 POP.o casa_variable.o cable_common.o cable_mpicommon.o 

cable_mpicommon.o: cable_mpicommon.F90  cable_iovars.o cable_define_types.o

cable_mpimaster.o: cable_mpimaster.F90 cable_mpicommon.o cable_output.o \
	cable_iovars.o cbl_model_driver_offline.o  casa_variable.o casa_cable.o casa_cnp.o \
	casa_inout.o cable_input.o cable_define_types.o cable_common.o \
	cable_sli_main.o cable_plume_mip.o pop_io.o pop_mpi.o \
	cable_climate.o cable_cru_TRENDY.o POPLUC.o cable_LUC_EXPT.o \
	CASAONLY_LUC.o cable_namelist_input.o \
	landuse_constant.o landuse3.o landuse_inout.o \
	cable_site.o cbl_soilsnow_init_special.o cable_diag.o 

cable_mpiworker.o: cable_mpiworker.F90 cable_mpicommon.o cable_output.o \
	cable_iovars.o cbl_model_driver_offline.o  casa_variable.o casa_cable.o casa_cnp.o \
	casa_inout.o cable_input.o cable_define_types.o  cable_common.o pop_mpi.o \
	landuse_constant.o landuse3.o landuse_inout.o \
	cable_climate.o cable_namelist_input.o cbl_soilsnow_init_special.o cbl_hgtAbove_snow.o cable_diag.o cbl_masks.o  cbl_albedo.o 

cable_mpidrv.o: cable_mpidrv.F90 cable_mpicommon.o cable_mpimaster.o cable_mpiworker.o cable_namelist_input.o


